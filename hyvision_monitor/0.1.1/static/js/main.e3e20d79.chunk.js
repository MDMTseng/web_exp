(this.webpackJsonpInspectionMonitor=this.webpackJsonpInspectionMonitor||[]).push([[0],{208:function(e,t,n){e.exports=n(474)},213:function(e,t,n){},214:function(e,t,n){e.exports=n.p+"static/media/logo.ee7cd8ed.svg"},215:function(e,t,n){},474:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),i=n(7),r=n.n(i),c=(n(213),n(133)),s=n(28),l=n(18),u=n(36),d=n(25),f=n(22),h=n(54),p=n(52),m=n(55),g=(n(214),n(215),n(31));function v(e){function t(e){return e<10?"0"+e:e}var n=t(e.getMonth()+1),a=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes()),r=t(e.getSeconds());return[e.getFullYear(),n,a].join("/")+" "+o+":"+i+":"+r}function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-1,a=e,o=n+1;if(void 0!==e){for(var i=0;i<o;i++){var r=t[i];if(void 0===(a=a[r]))return}return a}}n(216);var _=n(92),b=n.n(_),S=n(8),k=n.n(S),D=n(17),O=n.n(D),E=n(203),I=(n(221),n(72)),F=n.n(I),j="http://db.xception.tech:8080";function C(e,t,n){var a=j+"/query/deffile?";return a+="limit=1000",a+=function(e,t,n){var a="";return void 0!==e&&(a+="&name="+e),void 0!==t&&(a+="&featureSet_sha1="+t),a+=void 0!==n?"&projection="+JSON.stringify(n):"&projection={}"}(e,t,n),new Promise((function(e,t){F()(a,(function(n,a){null===n?e(a):t(n),console.log(n,a)}))}))}function R(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e6,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,c="/query/inspection",s=j+c+"?";return s+="subFeatureDefSha1="+e+"&",s+="tStart="+t+"&tEnd="+n+"&",void 0!==a&&(s+="limit="+a+"&page=1&"),void 0!==o&&(s+="sample="+o+"&"),void 0!=r&&(s+="agg="+JSON.stringify(r)+"&"),s+=void 0===i?"projection="+JSON.stringify({_id:0,"InspectionData.time_ms":1,"InspectionData.judgeReports.id":1,"InspectionData.judgeReports.value":1,"InspectionData.judgeReports.status":1,createdAt:1,updatedAt:1,"InspectionData.tag":1}):"projection="+JSON.stringify(i),s+="",new Promise((function(e,t){F()(s,(function(n,a){null===n?e(a):t(n),console.log(n,a)}))}))}var w,T=n(134),U=n.n(T),L=n(129),x=n.n(L),M=n(86),A=n.n(M),N=n(61),P=n.n(N),H=n(35),$=n.n(H),G=n(71),q=n.n(G),B=(n(226),new TextEncoder,{NA:-128,SUCCESS:0,FAILURE:-1}),Q=n(53),J=n.n(Q),X=n(89),z=n.n(X),Y=J.a.CheckableTag,K=A.a.RangePicker,V=$.a.Title;$.a.Paragraph,$.a.Text,E.getLogger("AnalysisUI");function W(e,t){e.forEach((function(e){e.stat.forEach((function(e){var n=t.find((function(t){return t.id==e.id}));if(void 0!==n){var a=function(e,t,n,a,o){var i=(n-e)/(3*t),r=(e-a)/(3*t),c=Math.min(i,r),s=(e-o)/((n-a)/2);return{mean:e,sigma:t,CPU:i,CPL:r,CP:c,CA:s,CPK:c*(1-Math.abs(s))}}(e.mean,e.sigma,n.USL,n.LSL,n.value);Object.assign(e,a)}}))}))}function Z(e,t,n){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12e4,n=e,a=[],o=void 0;function i(e){void 0!==e&&(o={group:[e],startTime:e.time_ms,endTime:e.time_ms},a.push(o))}i(n[0]);for(var r=1;r<n.length;r++)n[r].time_ms-o.endTime<t?(o.group.push(n[r]),o.endTime=n[r].time_ms):i(n[r]);return a.forEach((function(e){var t=e.group;if(0!=t.length){var n=t[0].judgeReports.map((function(e){return{id:e.id}}));n=n.map((function(e){var n=t.map((function(t){return t.judgeReports.find((function(t){return t.id==e.id}))})),a=n.filter((function(e){return e.status!==B.NA})),o=a.reduce((function(e,t){return e+t.value}),0)/a.length,i=n.reduce((function(e,t){return t.status===B.NA||((void 0===e.max||null===e.max||t.value>e.max)&&(e.max=t.value),(void 0===e.min||null===e.min||t.value<e.min)&&(e.min=t.value)),e}),{min:void 0,max:void 0}),r=Math.sqrt(a.reduce((function(e,t){return e+(o-+t.value)*(o-+t.value)}),0)/a.length);return{id:e.id,mean:o,sigma:r,min:i.min,max:i.max}})),e.stat=n}})),a}(e,t);return W(a,n),a}q.a.pluginService.register({afterDraw:function(e){}});var ee="NA",te="UOK",ne="LOK",ae="UCNG",oe="LCNG",ie="USNG",re="LSNG";w={},Object(g.a)(w,ee,{COLOR:"#aaa",TEXT:ee}),Object(g.a)(w,te,{COLOR:"#87d068",TEXT:te}),Object(g.a)(w,ne,{COLOR:"#87d068",TEXT:ne}),Object(g.a)(w,ae,{COLOR:"#d0d068",TEXT:ae}),Object(g.a)(w,oe,{COLOR:"#d0d068",TEXT:oe}),Object(g.a)(w,ie,{COLOR:"#f50",TEXT:ie}),Object(g.a)(w,re,{COLOR:"#f50",TEXT:re});var ce=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(p.a)(t).call(this,e))).divID="ControlChart_ID_"+Math.round(1e4*Math.random()),n.charObj=void 0,n.state={chartOpt:{type:"line",data:{labels:[],datasets:[{borderColor:"rgba(100, 255, 100,0)",lineTension:0,data:[],pointBackgroundColor:[]},{type:"scatter",borderColor:"rgba(100, 255, 100)",lineTension:0,data:[],pointBackgroundColor:[]}]},bezierCurve:!1,options:{scales:{xAxes:[{display:!0,type:"time",distribution:"linear",ticks:{callback:function(e,t,n){return e.toString()},source:"labels",autoSkip:!0},time:{displayFormat:!0,displayFormats:{hour:"M/D h:mm:ss"},minUnit:"hour"}}],yAxes:[{display:!0,scaleLabel:{display:!0}}]},elements:{line:{fill:!1},point:{radius:6}},bezierCurve:!1,animation:{duration:0},maintainAspectRatio:!1,responsive:!0,title:{display:!0,text:""},annotation:{annotations:[]},legend:{display:!0},tooltips:{enabled:!0}}}},n.state.chartOpt.options.pan={enabled:!0,mode:"y"},n.state.chartOpt.options.zoom={enabled:!0,mode:"y"},n.default_annotationTargets=[{type:"USL",color:"rgba(200, 0, 0,0.2)"},{type:"LSL",color:"rgba(200, 0, 0,0.2)"},{type:"UCL",color:"rgba(100, 100, 0,0.2)"},{type:"LCL",color:"rgba(100, 100, 0,0.2)"},{type:"value",color:"rgba(0, 0, 0,0.2)"}],n}return Object(m.a)(t,e),Object(f.a)(t,[{key:"componentWillMount",value:function(e,t){}},{key:"componentWillUpdate",value:function(e,t){this.PropsUpdate(e)}},{key:"genSingleRepPoints",value:function(e,t,n,a){var o=t.value;return e.reduce((function(e,t){return e.concat(t.group)}),[]).reduce((function(e,i,r){if(void 0!==n&&(n[0]>i.time_ms||n[1]<i.time_ms))return e;var c=i.judgeReports.find((function(e){return e.id===t.id})),s=c.value,l=a;if(void 0===l)switch(c.status){case B.SUCCESS:l="rgba(0,255,200,0.2)";break;case B.FAILURE:l="rgba(255,0,200,0.2)";break;case B.NA:l="#000000",s=o}else c.status===B.NA&&(l="#000000",s=o);var u={x:v(new Date(i.time_ms)),y:s,tag:i.tag};return e.pointBackgroundColor.push(l),e.data.push(u),e}),{borderColor:"rgba(100, 255, 100,0)",lineTension:0,data:[],pointBackgroundColor:[]})}},{key:"dataPointNormalizer",value:function(e,t,n,a){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return t==a||o&&(n<=a?a=n-(t-n):n>=t&&(t=n+(n-a)),t<=n||a>=n)?1/0:e>n?(e-n)/(t-n):(e-n)/(n-a)}},{key:"genGroupRepPoints",value:function(e,t,n,a){return e.reduce((function(e,o){var i=o.stat.find((function(e){return e.id===t.id})),r=i.mean,c=o.group.reduce((function(e,t){return e+t.time_ms}),0)/o.group.length;if(void 0!==n&&(n[0]>c||n[1]<c))return e;var s=void 0===a?"rgba(0,255,0,1)":a,l={x:v(new Date(c)),y:r,data:o,stat:i};return e.pointBackgroundColor.push(s),e.data.push(l),e}),{type:"line",borderColor:"rgba(100, 255, 100,1)",lineTension:0,data:[],pointBackgroundColor:[]})}},{key:"colorPalette",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"100%",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"50%",r=360*e/t+a;return"hsla("+r+", "+o+", "+i+","+n+")"}},{key:"PropsUpdate",value:function(e){console.log(">>>>");var t=1!=e.targetMeasure.length;this.targetMeasure_cache==e.targetMeasure&&this.inspectionRecGroup==e.inspectionRecGroup||this.doChartDataUpdate(e,t),this.targetMeasure_cache=e.targetMeasure,this.inspectionRecGroup=e.inspectionRecGroup;var n=-100,a=100,o=0;if(t)n=-100,a=100,o=0;else{var i=e.targetMeasure[0];n=i.LSL,a=i.USL,o=i.value}0==n&&0==a&&0==o||(this.state.chartOpt.options.scales.yAxes[0].ticks={min:1.2*(n-o)+o,max:1.2*(a-o)+o}),this.charObj.update()}},{key:"doChartDataUpdate",value:function(e,t){var n=this;if(this.state.chartOpt.data.labels=[],this.state.chartOpt.data.datasets.forEach((function(e){e.data=[],e.pointBackgroundColor=[]})),0!==e.inspectionRecGroup.length){var a=e.inspectionRecGroup,o=e.xAxisRange,i=-100,r=100,c=0;if(this.state.chartOpt.data.datasets=[],t)i=-100,r=100,c=0;else{var s=e.targetMeasure[0];i=s.LSL,r=s.USL,c=s.value}e.targetMeasure.forEach((function(e,i,c){var s=c.length>1?n.colorPalette(i,c.length,.4,100):void 0,l=n.genSingleRepPoints(a,e,o,s),u=n.colorPalette(i,c.length,1,100),d=n.genGroupRepPoints(a,e,o,u);if(t){var f=e.LSL,h=e.USL,p=e.value;l.data.forEach((function(e){e.original_y=e.y,e.y=r*n.dataPointNormalizer(e.y,h,p,f)})),d.data.forEach((function(e){e.original_y=e.y,e.y=r*n.dataPointNormalizer(e.y,h,p,f)}))}else l.data.forEach((function(e){e.original_y=e.y})),d.data.forEach((function(e){e.original_y=e.y}));var m=n.state.chartOpt.data.datasets;m.push(l),m.push(d),m[m.length-2].label="",m[m.length-1].label=e.name,m[m.length-2].backgroundColor=s,m[m.length-1].borderColor=u,m[m.length-1].backgroundColor=u})),this.state.chartOpt.data.labels=a.map((function(e){return v(new Date((e.startTime+e.endTime)/2))}));var l=this.props.anotationTargets;void 0===l&&(l=this.default_annotationTargets);var u={USL:r,LSL:i,value:c};this.state.chartOpt.options.annotation.annotations=l.map((function(e){return{type:"line",mode:"horizontal",scaleID:"y-axis-0",value:u[e.type],borderColor:e.color,borderWidth:4,borderDash:[12,12],label:{position:"right",enabled:!0,content:""},onMouseover:function(e){document.getElementById("info").innerHTML="whatever"}}})),this.state.chartOpt.options.tooltips={callbacks:{title:function(e,t){return""},label:function(e,t){var n=e.datasetIndex;if(void 0===n)return"";var a=e.index;return console.log(t,t.datasets[n]),t.datasets[n].data[a].original_y},afterLabel:function(e,t){var n=e.datasetIndex,a=e.index,o=t.datasets[n].data[a],i=o.stat;if(void 0===i)return o.x+"\ntag:"+o.tag;var r=o.data.group.length;if(0==r)return o.x;var c=[k()(o.data.group[0].time_ms).format("YYYY/MM/DD , h:mm:ss a"),k()(o.data.group[r-1].time_ms).format("YYYY/MM/DD , h:mm:ss a")],s=Object.keys(i).map((function(e){return e+":"+(null!=i[e]?i[e].toFixed(4):"NULL")}));return c=c.concat(s),void 0!==o.data.group&&c.push("count:"+o.data.group.length),c}},backgroundColor:"#FFF",titleFontSize:16,titleFontColor:"#0066ff",bodyFontColor:"#000",bodyFontSize:14,displayColors:!0}}}},{key:"componentDidMount",value:function(){var e=document.getElementById(this.divID).getContext("2d");this.charObj=new q.a(e,this.state.chartOpt),this.PropsUpdate(this.props)}},{key:"render",value:function(){return o.a.createElement("div",{className:this.props.className,style:this.props.style},o.a.createElement("canvas",{id:this.divID,style:{height:"100%"},className:this.props.className}))}}]),t}(o.a.Component);function se(e,t){return void 0===e&&(e=new Date),e.setDate(e.getDate()+t)}var le=function(){function e(){Object(d.a)(this,e),this.reset(),this.newFeedCallBack=function(e,t){return console.log("newFeedCallBack=>",e,t)},this.liveFeedMode=!1}return Object(f.a)(e,[{key:"resetStreamInfo",value:function(){this.rec=[],this.liveFeedInterval=1e4,this.passiveQueryRange=[],this.liveQueryRange=[],void 0!==this.timeoutHDL&&clearTimeout(this.timeoutHDL),this.timeoutHDL=void 0}},{key:"reset",value:function(){this.defFile=void 0,this.resetStreamInfo()}},{key:"setDefFile",value:function(e){this.resetStreamInfo(),this.defFile=JSON.parse(JSON.stringify(e)),console.log("setDefFile=",e)}},{key:"newStreamFeed",value:function(e){if(e.sort((function(e,t){return e.time_ms-t.time_ms})),this.rec.length>0){var t=this.rec[this.rec.length-1].time_ms,n=e.filter((function(e){return e.time_ms>t})),a=this.rec.concat(n);console.log(this.rec.length,e.length,a.length),this.rec=a}else this.rec=e;this.newFeedCallBack(e,this.rec)}},{key:"setLiveFeedMode",value:function(e){return console.log(e),this.rec.length<0&&(e=!1),console.log(this.rec),e?void 0==this.timeoutHDL&&this.liveQueryInspRec():void 0!==this.timeoutHDL&&(clearTimeout(this.timeoutHDL),this.timeoutHDL=void 0),this.liveFeedMode=e}},{key:"liveQueryInspRec",value:function(e,t,n){var a=this;if(void 0==e){if(!(this.rec.length>0))return console.log("No existed rec to do live query"),void(this.timeoutHDL=void 0);var o=this.rec[this.rec.length-1].time_ms;e=[k()(o)._d.getTime(),k()(se(new Date,1))._d.getTime()]}return console.log("timeRange="+e),R(this.defFile.featureSet_sha1,e[0],e[1],t,n).then((function(e){var t=e.map((function(e){return e.InspectionData[0]}));return a.newStreamFeed(t),a.liveFeedMode?a.timeoutHDL=setTimeout((function(){return a.liveQueryInspRec()}),a.liveFeedInterval):a.timeoutHDL=void 0,t}))}},{key:"queryInspRec",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[k()(se(new Date,-7)),k()(se(new Date,1))],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return void 0!==this.defFile&&(this.passiveQueryRange=e,this.liveFeedMode||this.resetStreamInfo(),this.liveQueryInspRec(e,void 0,t))}},{key:"queryInspRecSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[k()(se(new Date,-7)),k()(se(new Date,1))];return R(this.defFile.featureSet_sha1,e[0],e[1],1e6,void 0,{_id:1},{$count:"count"})}}]),e}();function ue(e){var t=e.shape_list,n=e.initRank,i=void 0===n?0:n,r=e.onListInfoChange,c=Object(a.useState)(i),u=Object(s.a)(c,2),d=u[0],f=u[1],h=Object(a.useState)({}),p=Object(s.a)(h,2),m=p[0],g=p[1],v=t.filter((function(e){return"measure"===e.type})),y=v.reduce((function(e,t){return e<t.rank?t.rank:e}),0),_=v.reduce((function(e,t){return e>t.rank?t.rank:e}),0);1e3==_&&(_=0,y=0),_==y&&(_=0);var b={};return b[_]=_+"",b[y]=y+"",v.forEach((function(e){void 0!==e.rank&&(b[e.rank]=e.rank+"")})),Object(a.useEffect)((function(){if(void 0!=r){var e={};t.forEach((function(t){e[t.id]={name:t.name,selected:void 0===t.rank||t.rank<=d}})),g(e),r(e)}}),[d]),0==_&&0==y?null:o.a.createElement("div",null,o.a.createElement("div",null,"Rank:"),o.a.createElement(U.a,{min:_,max:y,onChange:f,marks:b,value:d,style:{width:"300px",marginLeft:"auto",marginRight:"auto"}}),Object.keys(m).map((function(e){return o.a.createElement(Y,{checked:m[e].selected,onChange:function(t){var n=Object(l.a)({},m);n[e]=Object(l.a)({},n[e],{selected:t}),g(n),r(n)}},m[e].name)})))}var de=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(p.a)(t).call(this,e))).ec_canvas=null,n.state={defFileSearchName:"",dateRange:[k()(se(new Date,-1)),k()(se(new Date,1))],displayRange:[k()(0),k()(se(new Date,1))],inspectionRec:[],inspectionRec_TagFiltered:[],inspectionRecGroup:[],groupInterval:12e4,liveFeedMode:!1,dataInSync:!1,controlChartOverlap:!1,displayListInfo:{},tagState:{},modalInfo:void 0},n.recStream=new le,n}return Object(m.a)(t,e),Object(f.a)(t,[{key:"stateUpdate",value:function(e){return this.setState(Object(l.a)({},this.state,{},e))}},{key:"liveFeedMode_ctrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.state.liveFeedMode;return e=this.recStream.setLiveFeedMode(e),this.stateUpdate({liveFeedMode:e})}},{key:"shouldComponentUpdate",value:function(e,t){return e.defFile!==this.props.defFile&&(console.log("shouldComponentUpdate"),this.recStream.setDefFile(e.defFile)),!0}},{key:"popUp_downloading",value:function(){this.stateUpdate({modalInfo:{title:null,visible:!0,onOK:function(){},onCancel:function(){},content:"\u4e0b\u8f09\u4e2d....",footer:null},dataInSync:!0})}},{key:"SetDateRange",value:function(e,t){return this.setState({dateRange:function(e,t){return[k()(se(new Date,e)),k()(se(new Date,t))]}(e,t)})}},{key:"render",value:function(){var e=this;if(console.log(">>>>",this.state),void 0===this.state.defFile)return null;var t,n=2===this.state.dateRange.length&&this.state.dateRange.reduce((function(e,t){return e&&void 0!==t._d&&void 0!==t._d.getTime}),!0),a=this.state.dateRange.map((function(e){return e._d})),i=(this.props.DefFileHash,this.props.DefFileName,("string"===typeof(t=this.props.DefFileHash)||t instanceof String)&&this.props.DefFileHash.length>5),r=this.state.defFile.featureSet[0].features.filter((function(t){return void 0!==e.state.displayListInfo[t.id]&&e.state.displayListInfo[t.id].selected&&"measure"===t.type}));document.title=this.state.defFile.name;var c=o.a.createElement($.a,null,o.a.createElement(V,null,this.state.defFile.name)),s=null;this.state.inspectionRec.length>0&&(s=[o.a.createElement(U.a,{range:!0,min:this.state.inspectionRec[0].time_ms-1e3,max:this.state.inspectionRec[this.state.inspectionRec.length-1].time_ms+1e3,defaultValue:[this.state.inspectionRec[0].time_ms-1e3,this.state.inspectionRec[this.state.inspectionRec.length-1].time_ms+1e3],step:3e5,tipFormatter:function(e){return v(new Date(e))},onChange:function(t){return e.stateUpdate({displayRange:t})}}),o.a.createElement(P.a,{checked:this.state.liveFeedMode,onChange:function(t){return e.liveFeedMode_ctrl(t.target.checked)}},"LIVE"),"  \u62bd\u6aa2\u9593\u9694",o.a.createElement(x.a,{defaultValue:k()("0:"+this.state.groupInterval/6e4,"HH:mm"),format:"HH:mm",hourStep:3,minuteStep:1,allowClear:!1,onChange:function(t){if(null!==t){console.log(t);var n=t._d.getTime(),a=k()(t._d).startOf("date")._d.getTime();console.log(n-a);var o=n-a;console.log("TimePicker",e.state.inspectionRec_TagFiltered);var i=Z(e.state.inspectionRec_TagFiltered,o,r);e.stateUpdate({inspectionRecGroup:i,groupInterval:o})}}}),o.a.createElement(P.a,{checked:this.state.controlChartOverlap,onChange:function(t){return e.setState({controlChartOverlap:t.target.checked})}},"\u91cd\u758a\u986f\u793a")]),console.log(r);var u=null;u=this.state.controlChartOverlap?o.a.createElement("div",{style:{width:"95%",height:"100%"}},o.a.createElement(ce,{inspectionRecGroup:this.state.inspectionRecGroup,style:{height:"100%"},key:"_",targetMeasure:r,xAxisRange:this.state.displayRange})):o.a.createElement("div",{style:{width:"95%"}},r.map((function(t){return o.a.createElement(ce,{inspectionRecGroup:e.state.inspectionRecGroup,style:{height:"400px"},key:t.name+"_",targetMeasure:[t],xAxisRange:e.state.displayRange})})));var d=void 0===this.state.modalInfo?null:o.a.createElement(z.a,{title:this.state.modalInfo.title,visible:this.state.modalInfo.visible,maskClosable:1==this.state.modalInfo.maskClosable,closable:1==this.state.modalInfo.closable,onOk:this.state.modalInfo.onOK,okText:this.state.modalInfo.okText,onCancel:this.state.modalInfo.onCancel,cancelText:this.state.modalInfo.cancelText,footer:this.state.modalInfo.footer},this.state.modalInfo.content);return o.a.createElement("div",{className:"HXF"},o.a.createElement("div",{className:"overlayCon s overlayCon width12 HXF"},c,o.a.createElement("div",{className:"s height12"},o.a.createElement(O.a,{key:"_month",onClick:function(){return e.SetDateRange(-30,1)}},"\u6708(-30)"),o.a.createElement(O.a,{key:"half_month",onClick:function(){return e.SetDateRange(-15,1)}},"\u534a\u6708(-15)"),o.a.createElement(O.a,{key:"week",onClick:function(){return e.SetDateRange(-7,1)}},"\u661f\u671f(-7)"),o.a.createElement(O.a,{key:"day",onClick:function(){return e.SetDateRange(-1,1)}},"\u4e00\u5929(-1)"),o.a.createElement(K,{key:"RP",value:this.state.dateRange,onChange:function(t){return e.stateUpdate({dateRange:t})}}),o.a.createElement(O.a,{type:"primary",icon:"search",disabled:!n||!i||this.state.dataInSync,onClick:function(){e.popUp_downloading(),e.recStream.newFeedCallBack=function(t,n){if(t.length>0){var a=t[t.length-1].time_ms,o=Z(n,e.state.groupInterval,r);e.stateUpdate({inspectionRec:n,inspectionRecGroup:o,inspectionRec_TagFiltered:n,displayRange:[e.state.displayRange[0],k()(a+1e3)]})}},e.recStream.queryInspRecSize(a.map((function(e){return e.getTime()}))).then((function(t){var n=t[0].count;console.log(n);var i=5e3,r=i;n<r?e.recStream.queryInspRec(a.map((function(e){return e.getTime()}))).then((function(t){e.stateUpdate({dataInSync:!1,modalInfo:void 0})})).catch((function(t){e.stateUpdate({dataInSync:!1,modalInfo:void 0})})):e.stateUpdate({modalInfo:{title:"\u8b66\u544a",visible:!0,onOK:function(){e.stateUpdate({dataInSync:!1,modalInfo:void 0})},onCancel:function(){e.stateUpdate({dataInSync:!1,modalInfo:void 0})},content:"\u67e5\u8a62\u7d50\u679c\u6578\u91cf:"+n+" > "+r+" \u53d6\u6a23\u4e0b\u8f09? \u6216\u662f\u4ecd\u8981\u5168\u4e0b\u8f09?",okText:"\u5168\u4e0b\u8f09",footer:o.a.createElement(o.a.Fragment,null,o.a.createElement(O.a,{key:"_month",onClick:function(){e.recStream.queryInspRec(a.map((function(e){return e.getTime()}))).then((function(t){e.stateUpdate({dataInSync:!1,modalInfo:void 0})})).catch((function(t){e.stateUpdate({dataInSync:!1,modalInfo:void 0})})),e.popUp_downloading()}},"\u5168\u4e0b\u8f09"),o.a.createElement("br",null),"\u53d6\u6a23\u4e0b\u8f09:",[i,1e3,500].map((function(t){return o.a.createElement(O.a,{key:"samp_".concat(t),onClick:function(){e.recStream.queryInspRec(a.map((function(e){return e.getTime()})),t).then((function(t){e.stateUpdate({dataInSync:!1,modalInfo:void 0})})).catch((function(t){e.stateUpdate({dataInSync:!1,modalInfo:void 0})})),e.popUp_downloading()}},t)}))),maskClosable:!0}})})).catch((function(t){e.stateUpdate({dataInSync:!1,modalInfo:void 0})}))}}),o.a.createElement(O.a,{type:"primary",icon:"download",disabled:!n||!i||0===this.state.inspectionRec.length,onClick:function(){var t=e.state.defFile.name+"_"+function(e){var t=e.getMonth()+1,n=e.getDate();return[e.getFullYear(),(t>9?"":"0")+t,(n>9?"":"0")+n].join("")}(new Date),n=function(e,t,n,a){var o=[];function i(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n[n.length-1];e.push('"'+a+'"'),t.forEach((function(t){var a=y(t,n);void 0===a&&(a=""),e.push(',"'+a+'"')})),e.push("\n")}o.push('"'+e+'"'),o.push(',"0.0.1 Alpha"'),o.push(',,"tags"'),o.push(',"'+Object.keys(a).filter((function(e){return 1==a[e]})).join(",")+'"'),o.push(',"'+Object.keys(a).filter((function(e){return 0==a[e]||void 0===a[e]})).join(",")+'"'),o.push(',"'+Object.keys(a).filter((function(e){return-1==a[e]})).join(",")+'"'),o.push(",\n"),console.log(t,n),["name","subtype"].forEach((function(e){return i(o,t,[e])})),["USL","LSL","value","UCL","LCL"].forEach((function(e){return i(o,t,[e])})),o.push(",\n");var r=["tag"];return n.forEach((function(e){e.group.forEach((function(e){var n=e.judgeReports;o.push("'"+v(new Date(e.time_ms))),t.forEach((function(e){var t=n.find((function(t){return t.id==e.id}));t.status!==B.NA?o.push(","+t.value):o.push(",")})),r.forEach((function(t){switch(o.push(","),t){case"tag":var n=e.tag;n=void 0===n?"":n.replace(/^\,+/g,"").replace(/\,{2,}/g,","),o.push('"'+n+'"')}})),o.push("\n")}))})),o}(t,r,e.state.inspectionRecGroup,e.state.tagState);n.join("");!function(e,t,n){var a=new Blob([new Uint8Array([239,187,191]),e],{type:t}),o=document.createElement("a");o.download=n,o.href=URL.createObjectURL(a),o.dataset.downloadurl=[t,o.download,o.href].join(":"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout((function(){URL.revokeObjectURL(o.href)}),1500)}(n.join(""),"text/csv",t+".csv")}}),d,"\u8cc7\u6599\u6578:",this.state.inspectionRec_TagFiltered.length,o.a.createElement("hr",{style:{width:"80%"}}),o.a.createElement(fe,{fullStream2Tag:this.state.inspectionRec,control_margin_set:this.state.defFile.featureSet[0].__decorator.control_margin_info,onTagStateChange:function(t){var n=Object(l.a)({},e.state.defFile),a=n.featureSet[0].__decorator.control_margin_info,o=b()(a.__DEFAULT__);console.log(n,o);var i=Object.keys(t).filter((function(e){return 1==t[e]})),c=Object.keys(t).filter((function(e){return-1==t[e]})),s=i.find((function(e){return void 0!==a[e]}));if(void 0!==s){var u=a[s];o=o.map((function(e){var t=u.find((function(t){return t.id==e.id}));return void 0===t?e:Object(l.a)({},e,{},t)}))}n.featureSet[0].features=o;var d=e.state.inspectionRec.filter((function(e,t,n){var a=e.tag.split(","),o=i.every((function(e){return a.includes(e)})),r=c.some((function(e){return a.includes(e)}));return o&&!r}));console.log(n);var f=Z(d,e.state.groupInterval,r);e.stateUpdate({tagState:t,inspectionRecGroup:f,inspectionRec_TagFiltered:d,defFile:n})}}),o.a.createElement(ue,{shape_list:this.state.defFile.featureSet[0].features.filter((function(e){return"measure"===e.type})),onListInfoChange:function(t){console.log(t),e.setState({displayListInfo:t})}}),o.a.createElement("hr",{style:{width:"80%"}})),s,u,o.a.createElement("div",{key:"k1",className:"s overlay scroll MenuAnim HXA",style:{top:"0px",width:"100px"}},[])))}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(void 0===e.defFile)return null;if(e.defFile===t.__cached_defFile)return t;var n=b()(e.defFile),a=n.featureSet[0].features,o=n.featureSet[0].__decorator,i=o.list_id_order.map((function(e){return a.find((function(t){return t.id==e}))}));return n.featureSet[0].features=i,void 0===o.control_margin_info&&(o.control_margin_info={}),o.control_margin_info.__DEFAULT__=b()(n.featureSet[0].features),Object(l.a)({},t,{defFile:n,__cached_defFile:e.defFile})}}]),t}(o.a.Component),fe=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(p.a)(t).call(this,e))).handleTagChange=function(e,t){var a=Object(l.a)({},n.state.tags);1==t&&void 0!==n.props.control_margin_set&&void 0!==n.props.control_margin_set[e]&&Object.keys(a).forEach((function(e){void 0!==n.props.control_margin_set[e]&&(a[e]=0)})),void 0!==e&&(null==e?(Object.keys(a).every((function(e){return a[e]==t}))&&(t=0),Object.keys(a).forEach((function(e){a[e]=t}))):a[e]=t,n.props.onTagStateChange(a),n.setState({tags:a}))},n.state={tags:{},init:!0},n.checkInspectionRec=void 0,n}return Object(m.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillReceiveProps",value:function(e){if(this.checkInspectionRec!==e.fullStream2Tag){this.checkInspectionRec=e.fullStream2Tag,console.log("props.fullStream2Tag",e.fullStream2Tag);var t=new Set;if(e.fullStream2Tag.length>0){e.fullStream2Tag.forEach((function(e,n,a){e.tag.split(",").forEach((function(e,n,a){0!=e.length&&t.add(e)}))}));var n={};Array.from(t).forEach((function(e){n[e]=0})),this.setState({tags:n}),this.props.onTagStateChange(n)}}}},{key:"handleTagChange",value:function(){console.log("handleTagChange")}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(J.a,{color:"#87d068",onClick:function(t){return e.handleTagChange(null,1)}},"O"),":",Object.keys(this.state.tags).map((function(t){var n=t;return void 0!==e.props.control_margin_set&&void 0!==e.props.control_margin_set[t]&&(n="["+t+"]"),o.a.createElement(J.a,{color:1==e.state.tags[t]?"#87d068":void 0,key:t,onClick:function(n){return e.handleTagChange(t,1!=e.state.tags[t]?1:0)}},n)})),o.a.createElement("br",null),o.a.createElement(J.a,{color:"#f50",onClick:function(t){return e.handleTagChange(null,-1)}},"X"),":",Object.keys(this.state.tags).map((function(t,n,a){var i=t;return void 0!==e.props.control_margin_set&&void 0!==e.props.control_margin_set[t]&&(i="["+t+"]"),o.a.createElement(J.a,{color:-1==e.state.tags[t]?"#f50":void 0,key:t,onClick:function(n){return e.handleTagChange(t,-1!=e.state.tags[t]?-1:0)}},i)})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){console.log("props.fullStream2Tag",e.fullStream2Tag);var n=new Set;if(e.fullStream2Tag.length>0){e.fullStream2Tag.forEach((function(e,t,a){e.tag.split(",").forEach((function(e,t,a){0!=e.length&&n.add(e)}))}));var a=Object(l.a)({},t.tags);return Array.from(n).forEach((function(e){void 0===a[e]&&(a[e]=0)})),1==t.init&&e.onTagStateChange(a),{tags:a,init:!1}}return null}}]),t}(o.a.Component),he=de,pe=n(93),me="0.1.1",ge=n(131),ve=n.n(ge),ye=n(132),_e=n.n(ye),be=n(137),Se=n.n(be),ke=n(136),De=n.n(ke),Oe=n(45),Ee=n.n(Oe);pe.a.WORKER_PATH="./qr-scanner-worker.min.js";var Ie=A.a.RangePicker,Fe=$.a.Title;$.a.Paragraph,$.a.Text,o.a.Component;function je(e){var t=e?e.split("?")[1]:window.location.search.slice(1),n={};if(t=decodeURI(t))for(var a=(t=t.split("#")[0]).split("&"),o=0;o<a.length;o++){var i=a[o].split("="),r=i[0],c="undefined"===typeof i[1]||i[1];if(r.match(/\[(\d+)?\]$/)){var s=r.replace(/\[(\d+)?\]/,"");if(n[s]||(n[s]=[]),r.match(/\[\d+\]$/)){var l=/\[(\d+)\]/.exec(r)[1];n[s][l]=c}else n[s].push(c)}else n[r]?n[r]&&"string"===typeof n[r]?(n[r]=[n[r]],n[r].push(c)):n[r].push(c):n[r]=c}return n}function Ce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return new Promise((function(n,a){try{F()(e,{timeout:t},(function(e,t){null===e?n(t):a(e)}))}catch(o){a(o)}}))}function Re(e,t){var n;return new Promise((function(a,o){Ce(j+"/query/inspection?tStart="+e+"&tEnd="+t+'&projection={"InspectionData.subFeatureDefSha1":1,"InspectionData.time_ms":1,"InspectionData.tag":1}&agg=[{"$group":{"_id":"$InspectionData.subFeatureDefSha1","count":{"$sum":1},"time_start": {"$min":"$InspectionData.time_ms"},"time_end": {"$max":"$InspectionData.time_ms"},"tags": {"$addToSet":"$InspectionData.tag"}}}]').then((function(e){n=e.map((function(e){return e._id=e._id[0],e})).reduce((function(e,t){var n=t._id;return void 0===e[n]?(e[n]=t,delete e[n]._id):(e[n].count+=t.count,e[n].time_start=[Math.min(e[n].time_start[0],t.time_start[0])],e[n].time_end=[Math.max(e[n].time_end[0],t.time_end[0])]),e}),{});var t=Object.keys(n).reduce((function(e,t){return void 0===e?t:e+"|"+t}),void 0);return console.log(e,n,t),Ce(j+"/query/deffile?featureSet_sha1="+t+'&projection={"DefineFile.name":1,"DefineFile.featureSet_sha1":1,"DefineFile.featureSet_sha1_root":1,"DefineFile.featureSet_sha1_pre":1,"createdAt":1}')})).then((function(e){console.log(e);var t=e.reduce((function(e,t){var n=t.DefineFile.featureSet_sha1,a=Date.parse(t.createdAt);return t.p_createdAt=a,(void 0===e[n]||e[n].p_createdAt<t.p_createdAt)&&(e[n]=t),e}),{});console.log(t),(e=Object.values(t)).forEach((function(e){e.hash=e.DefineFile.featureSet_sha1,e.name=[e.DefineFile.name];var t=n[e.hash];void 0!==t&&(Object.assign(e,t),e.tags=e.tags.flat(9).map((function(e){return e.replace(/^,+|,+$/g,"").replace(/\,{2,}/g,",").split(",")})).flat(9).filter((function(e){return e.length>0})),e.tags=Object(u.a)(new Set(e.tags)))})),console.log(e),a(e)})).catch((function(e){o(e)}))}))}var we={read:function(e){return new Promise((function(t,n){var a=j+"/QUERY/customDisplay?name="+e;Ce(a+='&projection={"name":1,"targetDeffiles":1}').then((function(e){t(e)})).catch((function(e){n(e)}))}))},create:function(e,t){return new Promise((function(n,a){var o=j+"/insert/customdisplay?name="+e.name+"&targetDeffiles="+JSON.stringify(e.targetDeffiles);void 0!==t&&(o+="&_id="+t),Ce(o).then((function(e){n(e)})).catch((function(e){a(e)}))}))},delete:function(e){return new Promise((function(t,n){Ce(j+"/delete/customdisplay?_id="+e).then((function(e){t(e)})).catch((function(e){n(e)}))}))}};function Te(){return window.location.href.substring(window.location.protocol.length).split("?")[0]}function Ue(e,t){return void 0===e&&(e=new Date),e.setDate(e.getDate()+t)}function Le(e,t){return[k()(Ue(new Date,e)),k()(Ue(new Date,t))]}function xe(e){var t=e.onQueryRes,n=e.onQueryRej,i=e.placeholder,r=e.defaultValue,c=Object(a.useState)([]),d=Object(s.a)(c,2),f=d[0],h=d[1],p=Object(a.useState)(Le(-7,1)),m=Object(s.a)(p,2),g=m[0],y=m[1];console.log(g);var _=Object(a.useState)(void 0),b=Object(s.a)(_,2),S=b[0],k=b[1];function D(){k({view_fn:function(){return"\u53d6\u5f97\u8cc7\u6599\u4e2d"}})}function E(){k({view_fn:function(){return"\u53d6\u5f97\u8cc7\u6599\u5931\u6557"},title:"!"})}function I(){k()}function F(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g;return Re(e[0]._d.getTime(),e[1]._d.getTime()).then((function(e){h(e),t(e)})).catch((function(e){throw h([]),console.log(e),void 0!==n&&n(e),e}))}Object(a.useEffect)((function(){console.log("1,didUpdate"),D();try{F(g).then((function(e){console.log(e),I()})).catch((function(e){console.log(e),E()}))}catch(e){E(),console.log(e)}return function(){console.log("1,didUpdate ret::")}}),[]);var C=o.a.createElement(ve.a,{placeholder:i,defaultValue:r,onPressEnter:function(e){console.log(e.target.value),""==e.target.value?(D(),F(g).then((function(e){I()})).catch((function(e){E()}))):e.target.value.length<2?k({view_fn:function(){return"\u8acb\u8f38\u5165\u5927\u65bc\u5169\u500b\u5b57"},title:"!"}):(D(),h(),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,9999999999],n=void 0,a=j+"/query/deffile?name="+e+'&limit=1000&projection={"DefineFile.name":1,"DefineFile.featureSet_sha1":1,"DefineFile.featureSet_sha1_root":1,"DefineFile.featureSet_sha1_pre":1,"createdAt":1}';return Ce(a).then((function(e){var a=e.map((function(e){return e.DefineFile.featureSet_sha1}));a=Object(u.a)(new Set(a)),(n=a.map((function(t){var n=e.filter((function(e){return e.DefineFile.featureSet_sha1==t})).reduce((function(e,t){var n=Date.parse(t.createdAt);return void 0===e?Object(l.a)({p_createdAt:n},t):e.p_createdAt<n?e:Object(l.a)({p_createdAt:n},t)}));return Object(l.a)({hash:t},n,{name:n.DefineFile.name})}))).forEach((function(e){void 0===e.p_createdAt&&(e.p_createdAt=Date.parse(e.createdAt))}));var o=a.reduce((function(e,t){return void 0===e?t:e+"|"+t}),void 0),i=j+"/query/inspection?";return i+="tStart="+t[0]+"&tEnd="+t[1]+"&limit=9999999&",i+="subFeatureDefSha1="+o+"&",i+='projection={"_id":0,"InspectionData.subFeatureDefSha1":1,"InspectionData.time_ms":1,"InspectionData.tag":1}&',Ce(i+='agg=[{"$group":{"_id":"$InspectionData.subFeatureDefSha1","count": {"$sum":1},"time_start": {"$min":"$InspectionData.time_ms"},"time_end": {"$max":"$InspectionData.time_ms"},"tags": {"$addToSet":"$InspectionData.tag"}}}]')})).then((function(e){var t=e.map((function(e){return e._id=e._id[0],e})).reduce((function(e,t){var n=t._id;return void 0===e[n]?(e[n]=t,delete e[n]._id):(e[n].count+=t.count,e[n].time_start=[Math.min(e[n].time_start[0],t.time_start[0])],e[n].time_end=[Math.max(e[n].time_end[0],t.time_end[0])]),e}),{});return n.forEach((function(e){var n=t[e.hash];void 0!==n&&(Object.assign(e,n),e.tags=e.tags.flat(9).map((function(e){return e.replace(/^\,+/g,"").replace(/\,{2,}/g,",").split(",")})).flat(9).filter((function(e){return e.length>0})),e.tags=Object(u.a)(new Set(e.tags)))})),n})).catch((function(e){throw e}))}(e.target.value,[g[0]._d.getTime(),g[1]._d.getTime()]).then((function(e){I(),h(e),t(e)})).catch((function(e){E(),h([]),void 0!==n&&n(e)})))}}),R=(void 0===f||o.a.createElement("div",null),null);if(void 0!==f){var w=[{title:"Name",dataIndex:"name",key:"name",render:function(e,t){return o.a.createElement(o.a.Fragment,null,0==t.level?null:"\u2b91",void 0===t.link?e:o.a.createElement("a",{href:t.link,target:"_blank"},e),void 0===t.children?null:":+".concat(t.children.length))}},{title:"count",dataIndex:"count",key:"count",sorter:function(e,t){return e.count-t.count}},{title:"Date_Start",dataIndex:"Date_Start",key:"Date_Start",render:function(e){return v(new Date(e))},sorter:function(e,t){return e.Date_Start-t.Date_Start}},{title:"Date_End",dataIndex:"Date_End",key:"Date_End",render:function(e){return v(new Date(e))},sorter:function(e,t){return e.Date_End-t.Date_End},defaultSortOrder:"descend"},{title:"Tags",dataIndex:"Tags",key:"Tags",render:function(e){return e.join(",")}}];console.log(f);var T={};f.forEach((function(e){var t=e.DefineFile.featureSet_sha1_root||"_";void 0===T[t]&&(T[t]=[]),T[t].push(e)})),console.log(T);var U=Object.keys(T).map((function(e,t){var n=T[e].filter((function(e){return void 0!==e.count})).map((function(e){return{level:1,name:e.name,count:e.count,Date_Start:e.time_start[0],Date_End:e.time_end[0],Tags:e.tags,info:e,hash:e.hash,key:e.hash,link:Te()+"?v=0&hash="+e.hash}})),a=n.reduce((function(e,t){var n=Object(l.a)({},e);return n.Date_End<t.Date_End&&(n.name=t.name,n.Date_End=t.Date_End),n.Date_Start>t.Date_Start&&(n.Date_Start=t.Date_Start),n.Tags=[].concat(Object(u.a)(n.Tags),Object(u.a)(t.Tags)),n.hash=[].concat(Object(u.a)(n.hash),[t.hash]),n.count+=t.count,n.count+=t.count,n}),{level:0,name:void 0,count:0,Date_End:0,Date_Start:Number.MAX_VALUE,hash:[],Tags:[],info:n,children:n.length>1?n:void 0});return a.Tags=Object(u.a)(new Set(a.Tags)),a.hash=Object(u.a)(new Set(a.hash)),a.key="-"+a.hash[0],1==a.hash.length&&(a.link=Te()+"?v=0&hash="+a.hash[0]),a})).filter((function(e){return void 0!==e.count&&e.count>0}));console.log(U),R=o.a.createElement(_e.a,{columns:w,dataSource:U,pagination:!1})}return o.a.createElement(o.a.Fragment,null,C,o.a.createElement(O.a,{key:"_month",onClick:function(){y(Le(-30,1))}},"\u6708(-30)"),o.a.createElement(O.a,{key:"half_month",onClick:function(){y(Le(-15,1))}},"\u534a\u6708(-15)"),o.a.createElement(O.a,{key:"week",onClick:function(){y(Le(-7,1))}},"\u661f\u671f(-7)"),o.a.createElement(Ie,{key:"RP",value:g,onChange:function(e){return y(e)}}),R,o.a.createElement(z.a,Object.assign({footer:null,onCancel:function(){return k()},onOk:function(){return k()}},S,{visible:void 0!==S}),void 0===S?null:S.view_fn()),"version:",me)}function Me(e){var t=e.displayInfo,n=o.a.useRef(null);return o.a.createElement("div",null,o.a.createElement(Fe,{level:2},t.name),"Name:",t.name,t.targetDeffiles.map((function(e,n){return"Def["+n+"]:"+JSON.stringify(t.targetDeffiles[n])})),o.a.createElement("canvas",{key:"canv",ref:n,onClick:function(e){n.current.getContext("2d")}}))}function Ae(e){Object(c.a)(e);var t=Object(a.useState)(void 0),n=Object(s.a)(t,2),i=n[0],r=n[1],l=Object(a.useState)(!0),u=Object(s.a)(l,2),d=u[0],f=u[1];Object(a.useEffect)((function(){return r(void 0),we.read(".").then((function(e){console.log(i),r(e.prod)})).catch((function(e){console.log(e)})),function(){console.log("1,didUpdate ret::")}}),[]),Object(a.useEffect)((function(){console.log("2,count->useEffect>>")}),[i]);var h=[];return void 0!==i&&(console.log(i),(h=[]).push(o.a.createElement("div",{key:"Reset",onClick:function(){return r(void 0)}},"RESET....")),h.push(o.a.createElement(De.a,{key:"table",style:{height:"50%"}},i.map((function(e){return o.a.createElement(Se.a,{key:e._id,span:12,style:{height:"100%"}},o.a.createElement(Me,{displayInfo:e}),o.a.createElement(O.a,{key:"sdsdfk",onClick:function(){e.ddd="sss",we.update({name:"OKOK",targetDeffiles:[{hash:""}]},e._id).then((function(){we.read(".").then((function(e){console.log(i),r(e.prod)})).catch((function(e){console.log(e)}))}))},style:{width:"60%"}},"mod"),o.a.createElement(O.a,{type:"dashed",onClick:function(){r(void 0),we.delete(e._id).then((function(){we.read(".").then((function(e){console.log(i),r(e.prod)})).catch((function(e){console.log(e)}))}))},style:{width:"60%"}},"\uff38"))}))))),h.push(o.a.createElement(De.a,{key:"table2",style:{height:"50%"}},o.a.createElement(Se.a,{key:"sdsd",span:12,style:{height:"100%"}},o.a.createElement(O.a,{type:"dashed",onClick:function(){we.create({name:"><>",targetDeffiles:[{hash:"sdiosdjciojsdoi"}]},void 0).then((function(){we.read(".").then((function(e){console.log(i),r(e.prod)})).catch((function(e){console.log(e)}))}))},style:{width:"60%"}},"Add field")))),o.a.createElement(Ee.a,{style:{height:"100%"}},o.a.createElement(Ee.a.Header,{style:{color:"#FFFFFF"}},"Header"),o.a.createElement(Ee.a,null,o.a.createElement(Ee.a.Sider,{style:{color:"#FFFFFF"},collapsible:!0,collapsed:d,onCollapse:function(){return f(!d)},onMouseOut:function(){return d?null:f(!0)},onMouseOver:function(){return d?f(!1):null}},"Sider"),o.a.createElement(Ee.a,null,o.a.createElement(Ee.a.Content,{style:{padding:"50px 50px"}},h),o.a.createElement(Ee.a.Footer,null,"Custom UI v0.0.0"))))}function Ne(e){Object(c.a)(e);var t=Object(a.useState)(void 0),n=Object(s.a)(t,2),o=(n[0],n[1],Object(a.useState)(!0)),i=Object(s.a)(o,2);i[0],i[1];return new Promise((function(e,t){Ce('http://db.xception.tech:8080/query/deffile?name=&limit=1000&agg=[{"$group":{"_id":"$DefineFile.featureSet_sha1","count":{"$sum":1}}}]').then((function(e){console.log(e)})).catch((function(e){t(e)}))})),">>"}we.update=function(e,t){return new Promise((function(n,a){if(void 0===t)return a("Error:No id");we.create(e,t).then((function(e){n(e)})).catch((function(e){a(e)}))}))};var Pe=function(e){function t(e){var n;return Object(d.a)(this,t),n=Object(h.a)(this,Object(p.a)(t).call(this,e)),console.log(je()),n.state={DefFileInfo:void 0,allowQRScan:!1,UI:void 0},n.UI_type={customDisplay:"customDisplay",dbDupMan:"dbDupMan",analysis:"analysis",search:"search"},n}return Object(m.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=je();console.log(e),"customDisplay"===e.UI&&this.setState({UI:this.UI_type.customDisplay}),"dbDupMan"===e.UI?this.setState({UI:this.UI_type.dbDupMan}):void 0!==e.v&&void 0!==e.hash?(this.onQRScanResult(JSON.stringify(e)),this.setState({UI:this.UI_type.analysis})):this.setState({allowQRScan:!0,UI:this.UI_type.search})}},{key:"onDefFileInfoUpdate",value:function(e){var t=this;this.setState(Object(l.a)({},this.state,{DefFileInfo:e})),console.log(e),C(e.name,e.hash).then((function(e){e.length>0&&t.setState(Object(l.a)({},t.state,{defFile:e[e.length-1].DefineFile})),console.log(e)}))}},{key:"onQRScanResult",value:function(e){try{var t=JSON.parse(e);("string"===typeof(n=t.v)||n instanceof String)&&(t.v=Number(t.v)),0===t.v&&void 0!==t.hash&&t.hash.length>5&&(console.log(window.location.protocol),"https:"===window.location.protocol?(window.location.href="http:"+window.location.href.substring(window.location.protocol.length).split("?")[0]+"?v="+t.v+"&hash="+t.hash,console.log(window.location.href),this.setState(Object(l.a)({},this.state,{allowQRScan:!1}))):this.onDefFileInfoUpdate(t))}catch(a){alert(a)}var n}},{key:"render",value:function(){var e;switch(this.state.UI){case this.UI_type.customDisplay:e=o.a.createElement(Ae,null);break;case this.UI_type.dbDupMan:e=o.a.createElement(Ne,null);break;case this.UI_type.analysis:e=o.a.createElement(he,{DefFileHash:this.state.DefFileInfo.hash,DefFileName:this.state.DefFileInfo.name,defFile:this.state.defFile});break;case this.UI_type.search:e=o.a.createElement(xe,{onQueryRes:function(e){console.log(e)},defaultValue:"",placeholder:"\u8f38\u5165\u540d\u7a31"})}return o.a.createElement("div",{className:"App",style:{height:"100%"}},e)}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(Pe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[208,1,2]]]);
//# sourceMappingURL=main.e3e20d79.chunk.js.map