(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{196:function(e,t,n){e.exports=n(451)},201:function(e,t,n){},202:function(e,t,n){e.exports=n.p+"static/media/logo.ee7cd8ed.svg"},203:function(e,t,n){},451:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),o=n(7),r=n.n(o),s=(n(201),n(45)),l=n(23),c=n(18),u=n(47),d=n(46),h=n(48),p=(n(202),n(203),n(19));function f(e){var t=1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),n=Math.round(t);return 0===n&&(n=t),Math.round(e*n)/n}n(204);var m=n(8),v=n.n(m),g=n(187),y=n.n(g),b=n(56),O=n.n(b),R=n(184),F=(n(205),n(121)),S=n.n(F),w="http://hyv.decade.tw:8080/";var C,D=n(192),j=n.n(D),k=n(120),L=n.n(k),I=n(185),x=n.n(I),M=n(64),_=n.n(M),E=n(67),T=n.n(E),N=n(194),U=n(65),A=n.n(U),H=(n(210),x.a.RangePicker),P=T.a.Title;T.a.Paragraph,T.a.Text,R.getLogger("AnalysisUI");function Q(e,t){var n=t,a=e.map(function(e){var t=n.map(function(t){return t.judgeReports.find(function(t){return t.id===e.id}).value}),a=t.reduce(function(e,t){return e+t},0)/t.length,i=Math.sqrt(t.reduce(function(e,t){return e+(a-t)*(a-t)},0)/t.length),o=(e.USL-a)/(3*i),r=(a-e.LSL)/(3*i),s=Math.min(o,r),l=(a-e.value)/((e.USL-e.LSL)/2),c=s*(1-Math.abs(l)),u=e.id,d=e.name,h=e.subtype;return o=f(o,.001),r=f(r,.001),s=f(s,.001),l=f(l,.001),c=f(c,.001),{id:u,name:d,subtype:h,measure:e,valArr:t,mean:a,sigma:i,CPU:o,CPL:r,CP:s,CA:l,CPK:c}});return console.log(a),a}A.a.pluginService.register({afterDraw:function(e){console.log(e)}});i.a.Component;function q(e){return"string"===typeof e||e instanceof String}var B="NA",W="UOK",X="LOK",z="UCNG",J="LCNG",K="USNG",G="LSNG";C={},Object(p.a)(C,B,{COLOR:"#aaa",TEXT:B}),Object(p.a)(C,W,{COLOR:"#87d068",TEXT:W}),Object(p.a)(C,X,{COLOR:"#87d068",TEXT:X}),Object(p.a)(C,z,{COLOR:"#d0d068",TEXT:z}),Object(p.a)(C,J,{COLOR:"#d0d068",TEXT:J}),Object(p.a)(C,K,{COLOR:"#f50",TEXT:K}),Object(p.a)(C,G,{COLOR:"#f50",TEXT:G});var V=function(e){function t(e){var n,a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).divID="ControlChart_ID_"+Math.round(1e4*Math.random()),a.charObj=void 0,a.state={chartOpt:{type:"line",data:{labels:[],datasets:[{borderColor:"rgba(100, 255, 100,0)",lineTension:0,data:[],pointBackgroundColor:[]},{type:"scatter",borderColor:"rgba(100, 255, 100)",lineTension:0,data:[],pointBackgroundColor:[]}]},bezierCurve:!1,options:(n={responsive:!0,scales:{xAxes:[{display:!0,type:"time",distribution:"linear",ticks:{callback:function(e,t,n){return e.toString()},source:"labels",autoSkip:!0},time:{displayFormat:!0,displayFormats:{hour:"MMM D, h:mm:ss"},minUnit:"hour"}}],yAxes:[{display:!0,scaleLabel:{display:!0}}]},elements:{line:{fill:!1},point:{radius:6}},bezierCurve:!1,animation:{duration:0},maintainAspectRatio:!1},Object(p.a)(n,"responsive",!0),Object(p.a)(n,"title",{display:!0,text:""}),Object(p.a)(n,"annotation",{annotations:[]}),Object(p.a)(n,"legend",{display:!1}),Object(p.a)(n,"tooltips",{enabled:!0}),n)}},a.state.chartOpt.options.pan={enabled:!0,mode:"y"},a.default_annotationTargets=[{type:"USL",color:"rgba(200, 0, 0,0.2)"},{type:"LSL",color:"rgba(200, 0, 0,0.2)"},{type:"UCL",color:"rgba(100, 100, 0,0.2)"},{type:"LCL",color:"rgba(100, 100, 0,0.2)"},{type:"value",color:"rgba(0, 0, 0,0.2)"}],a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(e,t){}},{key:"componentWillUpdate",value:function(e,t){this.PropsUpdate(e)}},{key:"PropsUpdate",value:function(e){if(this.state.chartOpt.data.labels=[],this.state.chartOpt.data.datasets.forEach(function(e){e.data=[],e.pointBackgroundColor=[]}),0!==e.reportArray.length){this.state.chartOpt.options.title.text=e.targetMeasure.name,e.reportArray.reduce(function(t,n,a){if(void 0!==e.xAxisRange&&(e.xAxisRange[0]>n.time_ms||e.xAxisRange[1]<n.time_ms))return t;var i=n.judgeReports.find(function(t){return t.id===e.targetMeasure.id});if(-128===i.status)return t;var o={x:new Date(n.time_ms).toString(),y:i.value};return t.datasets[0].pointBackgroundColor.push(void 0),t.datasets[0].data.push(o),t},this.state.chartOpt.data);var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12e4,n=e,a=[],i=void 0;function o(e){i={group:[e],startTime:e.time_ms,endTime:e.time_ms},a.push(i)}o(n[0]);for(var r=1;r<n.length;r++)n[r].time_ms-i.endTime<t?(i.group.push(n[r]),i.endTime=n[r].time_ms):o(n[r]);return a.forEach(function(e){var t=e.group;if(0!=t.length){var n=t[0].judgeReports.map(function(e){return{id:e.id}});n=n.map(function(e){var n=t.map(function(t){return t.judgeReports.find(function(t){return t.id==e.id})}),a=n.reduce(function(e,t){return e+t.value},0)/n.length,i=Math.sqrt(n.reduce(function(e,t){return e+(a-+t.value)*(a-+t.value)},0)/n.length);return{id:e.id,mean:a,sigma:i}}),e.stat=n}}),a}(e.reportArray,this.props.groupInterval),n=e.targetMeasure;t.reduce(function(t,a,i){var o=a.stat.find(function(t){return t.id===e.targetMeasure.id}),r=function(e,t,n,a,i){var o=(n-e)/(3*t),r=(e-a)/(3*t),s=Math.min(o,r),l=(e-i)/((n-a)/2);return{mean:e,sigma:t,CPU:o,CPL:r,CP:s,CA:l,CPK:s*(1-Math.abs(l))}}(o.mean,o.sigma,n.USL,n.LSL,n.value);console.log(r),Object.assign(o,r);var s=o.mean,l=a.group.reduce(function(e,t){return e+t.time_ms},0)/a.group.length;if(void 0!==e.xAxisRange&&(e.xAxisRange[0]>l||e.xAxisRange[1]<l))return t;t.labels.push(new Date(l));var c={x:new Date(l).toString(),y:s,data:a,stat:o};return t.datasets[1].pointBackgroundColor.push(void 0),t.datasets[1].data.push(c),t},this.state.chartOpt.data);var a=this.props.anotationTargets;void 0===a&&(a=this.default_annotationTargets),this.state.chartOpt.options.annotation.annotations=a.map(function(t){return{type:"line",mode:"horizontal",scaleID:"y-axis-0",value:e.targetMeasure[t.type],borderColor:t.color,borderWidth:4,borderDash:[12,12],label:{position:"right",enabled:!0,content:t.type},onMouseover:function(e){document.getElementById("info").innerHTML="whatever"}}}),this.state.chartOpt.options.tooltips={callbacks:{title:function(e,t){var n=e[0].datasetIndex,a=e[0].index;return console.log(t,e,n,a),t.datasets[n].data[a].y},label:function(e,t){var n=e.datasetIndex,a=e.index,i=t.datasets[n].data[a];console.log(i);var o=i.stat;return void 0==o?"":(console.log(o),Object.keys(o).map(function(e){return e+":"+o[e].toFixed(4)}))},afterLabel:function(e,t){var n=e.datasetIndex,a=e.index;return t.datasets[n].data[a].x}},backgroundColor:"#FFF",titleFontSize:16,titleFontColor:"#0066ff",bodyFontColor:"#000",bodyFontSize:14,displayColors:!1};var i=e.targetMeasure.LSL,o=e.targetMeasure.USL,r=e.targetMeasure.value;this.state.chartOpt.options.scales.yAxes[0].ticks={min:1.2*(i-r)+r,max:1.2*(o-r)+r},void 0!==this.charObj&&this.charObj.update()}}},{key:"componentDidMount",value:function(){var e=document.getElementById(this.divID).getContext("2d");this.charObj=new A.a(e,this.state.chartOpt),this.PropsUpdate(this.props)}},{key:"onResize",value:function(e,t){}},{key:"render",value:function(){return i.a.createElement("div",{className:this.props.className,style:this.props.style},i.a.createElement("canvas",{id:this.divID,style:{height:"100%"},className:this.props.className}),i.a.createElement(N.a,{handleWidth:!0,handleHeight:!0,onResize:this.onResize.bind(this)}))}}]),t}(i.a.Component);function $(e,t){return void 0===e&&(e=new Date),e.setDate(e.getDate()+t)}var Y=function(){function e(){Object(l.a)(this,e),this.reset(),this.newFeedCallBack=function(e,t){return console.log(e,t)},this.liveFeedMode=!1}return Object(c.a)(e,[{key:"resetStreamInfo",value:function(){this.rec=[],this.liveFeedInterval=1e4,this.passiveQueryRange=[],this.liveQueryRange=[],void 0!==this.timeoutHDL&&clearTimeout(this.timeoutHDL),this.timeoutHDL=void 0}},{key:"reset",value:function(){this.defFile=void 0,this.resetStreamInfo()}},{key:"setDefFile",value:function(e){this.resetStreamInfo(),this.defFile=JSON.parse(JSON.stringify(e))}},{key:"newStreamFeed",value:function(e){if(e.sort(function(e,t){return e.time_ms-t.time_ms}),this.rec.length>0){var t=this.rec[this.rec.length-1].time_ms,n=e.filter(function(e){return e.time_ms>t}),a=this.rec.concat(n);console.log(this.rec.length,e.length,a.length),this.rec=a}else this.rec=e;this.newFeedCallBack(e,this.rec)}},{key:"setLiveFeedMode",value:function(e){return console.log(e),this.rec.length<0&&(e=!1),console.log(this.rec),e?void 0==this.timeoutHDL&&this.liveQueryInspRec():void 0!==this.timeoutHDL&&(clearTimeout(this.timeoutHDL),this.timeoutHDL=void 0),this.liveFeedMode=e}},{key:"liveQueryInspRec",value:function(e,t){var n=this;if(void 0==e){if(!(this.rec.length>0))return console.log("No existed rec to do live query"),this.timeoutHDL=void 0,!1;var a=this.rec[this.rec.length-1].time_ms;e=[v()(a)._d.getTime(),v()($(new Date,1))._d.getTime()],console.log(v()(a))}return void 0==t&&(t=10),console.log(e),function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=w+"query/inspection?";return i+="tStart="+t.toString()+"&tEnd="+n.toString()+"&",i+="limit="+a+"&page=1&",i+="subFeatureDefSha1="+e+"&",i+="projection="+JSON.stringify({_id:0,"InspectionData.time_ms":1,"InspectionData.judgeReports.id":1,"InspectionData.judgeReports.value":1,"InspectionData.judgeReports.status":1}),i+="",new Promise(function(e,t){S()(i,function(n,a){null===n?e(a):t(n),console.log(n,a)})})}(this.defFile.featureSet_sha1,e[0],e[1],t).then(function(e){var t=e.map(function(e){return e.InspectionData[0]});n.newStreamFeed(t),n.liveFeedMode?n.timeoutHDL=setTimeout(function(){return n.liveQueryInspRec()},n.liveFeedInterval):n.timeoutHDL=void 0}).catch(function(e){console.log(e)}),!0}},{key:"queryInspRec",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[v()($(new Date,-7)),v()($(new Date,1))];return void 0!==this.defFile&&(this.passiveQueryRange=e,this.liveFeedMode||this.resetStreamInfo(),this.liveQueryInspRec(e,1e7))}}]),e}(),Z=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).ec_canvas=null,n.state={defFileSearchName:"",dateRange:[v()($(new Date,-7)),v()($(new Date,1))],displayRange:[v()(0),v()($(new Date,1))],inspectionRec:[],groupInterval:6e5,liveFeedMode:!1},n.recStream=new Y,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}}]),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.defFile!==this.props.defFile&&this.recStream.setDefFile(e.defFile),!0}},{key:"stateUpdate",value:function(e){return this.setState(Object(s.a)({},this.state,e))}},{key:"liveFeedMode_ctrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.state.liveFeedMode;return e=this.recStream.setLiveFeedMode(e),this.stateUpdate({liveFeedMode:e})}},{key:"render",value:function(){var e=this;if(void 0===this.props.defFile)return null;var t=2===this.state.dateRange.length&&this.state.dateRange.reduce(function(e,t){return e&&void 0!==t._d&&void 0!==t._d.getTime},!0),n=this.state.dateRange.map(function(e){return e._d}),a=(this.props.DefFileHash,this.props.DefFileName,q(this.props.DefFileHash)&&this.props.DefFileHash.length>5);console.log(this.props.defFile);var o=this.props.defFile.featureSet[0].features.filter(function(e){return"measure"===e.type});console.log(this.props.defFile),document.title=this.props.defFile.name;var r=i.a.createElement(T.a,null,i.a.createElement(P,null,this.props.defFile.name)),s=null;this.state.inspectionRec.length>0&&(s=[i.a.createElement(j.a,{range:!0,min:this.state.inspectionRec[0].time_ms-1e3,max:this.state.inspectionRec[this.state.inspectionRec.length-1].time_ms+1e3,defaultValue:[this.state.inspectionRec[0].time_ms-1e3,this.state.inspectionRec[this.state.inspectionRec.length-1].time_ms+1e3],step:3e5,tipFormatter:function(e){return new Date(e).toString()},onChange:function(t){return e.stateUpdate({displayRange:t})}}),i.a.createElement(_.a,{checked:this.state.liveFeedMode,onChange:function(t){return e.liveFeedMode_ctrl(t.target.checked)}},"LIVE"),i.a.createElement(L.a,{defaultValue:v()("0:30","HH:mm"),format:"HH:mm",minuteStep:5,allowClear:!1,onChange:function(t){if(null!==t){console.log(t);var n=t._d.getTime(),a=v()(t._d).startOf("date")._d.getTime();console.log(n-a),e.stateUpdate({groupInterval:n-a})}}})]);var l;return l=i.a.createElement("div",{style:{width:"95%"}},o.map(function(t){return i.a.createElement(V,{reportArray:e.state.inspectionRec,style:{height:"400px"},key:t.name+"_",targetMeasure:t,xAxisRange:e.state.displayRange,groupInterval:e.state.groupInterval})})),i.a.createElement("div",{className:"HXF"},i.a.createElement("div",{className:"overlayCon s overlayCon width12 HXF"},r,i.a.createElement("div",{className:"s height12"},i.a.createElement(H,{key:"RP",defaultValue:this.state.dateRange,onChange:function(t){return e.stateUpdate({dateRange:t})}}),i.a.createElement(O.a,{type:"primary",icon:"search",disabled:!t||!a,onClick:function(){e.recStream.newFeedCallBack=function(t,n){if(t.length>0){var a=t[t.length-1].time_ms;e.stateUpdate({inspectionRec:n,displayRange:[e.state.displayRange[0],v()(a+1e3)]})}},e.recStream.queryInspRec(n)}}),i.a.createElement(O.a,{type:"primary",icon:"download",disabled:!t||!a||0===this.state.inspectionRec.length,onClick:function(){}})),s,l,i.a.createElement("div",{key:"k1",className:"s overlay scroll MenuAnim HXA",style:{top:"0px",width:"100px"}},[])))}}]),t}(i.a.Component),ee=n(193),te=n.n(ee),ne=n(86);ne.a.WORKER_PATH="./qr-scanner-worker.min.js";var ae=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.refs.QR_WebCam;ne.a.hasCamera().then(function(e){return console.log(e)}),this.qrScanner=new ne.a(e,this.props.onScanResult),this.qrScanner.start(),console.log(this.qrScanner)}},{key:"componentWillUnmount",value:function(){this.qrScanner.destroy(),this.qrScanner=void 0}},{key:"render",value:function(){return i.a.createElement("video",{ref:"QR_WebCam",className:this.props.className,style:this.props.style,muted:!0,playsInline:!0})}}]),t}(i.a.Component);function ie(e){var t=e?e.split("?")[1]:window.location.search.slice(1),n={};if(t)for(var a=(t=t.split("#")[0]).split("&"),i=0;i<a.length;i++){var o=a[i].split("="),r=o[0],s="undefined"===typeof o[1]||o[1];if((r=r.toLowerCase()).match(/\[(\d+)?\]$/)){var l=r.replace(/\[(\d+)?\]/,"");if(n[l]||(n[l]=[]),r.match(/\[\d+\]$/)){var c=/\[(\d+)\]/.exec(r)[1];n[l][c]=s}else n[l].push(s)}else n[r]?n[r]&&"string"===typeof n[r]?(n[r]=[n[r]],n[r].push(s)):n[r].push(s):n[r]=s}return n}var oe=function(e){function t(e){var n;return Object(l.a)(this,t),n=Object(u.a)(this,Object(d.a)(t).call(this,e)),console.log(ie()),n.state={DefFileInfo:void 0,allowQRScan:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=ie();void 0!==e.v&&void 0!==e.name&&void 0!==e.hash?this.onQRScanResult(JSON.stringify(e)):this.setState(Object(s.a)({},this.state,{allowQRScan:!0}))}},{key:"onDefFileInfoUpdate",value:function(e){var t=this;this.setState(Object(s.a)({},this.state,{DefFileInfo:e})),console.log(e),function(e,t,n){var a=w+"query/deffile?";return a+="limit=1000",void 0!==e&&(a+="&name="+e),void 0!==t&&(a+="&featureSet_sha1="+t),a+=void 0!==n?"&projection="+JSON.stringify(n):"&projection={}",new Promise(function(e,t){S()(a,function(n,a){null===n?e(a):t(n),console.log(n,a)})})}(e.name,e.hash).then(function(e){e.length>0&&t.setState(Object(s.a)({},t.state,{defFile:e[0].DefineFile})),console.log(e)})}},{key:"onQRScanResult",value:function(e){try{var t=JSON.parse(e);("string"===typeof(n=t.v)||n instanceof String)&&(t.v=Number(t.v)),0===t.v&&void 0!==t.hash&&t.hash.length>5&&(console.log(window.location.protocol),"https:"===window.location.protocol?(window.location.href="http:"+window.location.href.substring(window.location.protocol.length).split("?")[0]+"?v="+t.v+"&hash="+t.hash+"&name="+t.name,console.log(window.location.href),this.setState(Object(s.a)({},this.state,{allowQRScan:!1}))):this.onDefFileInfoUpdate(t))}catch(a){alert(a)}var n}},{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement(te.a,{title:null,visible:void 0===this.state.DefFileInfo,onCancel:this.props.onCancel,onOk:this.props.onOk},void 0===this.state.DefFileInfo&&this.state.allowQRScan?i.a.createElement(ae,{style:{width:"100%",height:"100%"},onScanResult:this.onQRScanResult.bind(this)}):null),void 0!==this.state.DefFileInfo?i.a.createElement(Z,{DefFileHash:this.state.DefFileInfo.hash,DefFileName:this.state.DefFileInfo.name,defFile:this.state.defFile}):null)}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(oe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[196,1,2]]]);
//# sourceMappingURL=main.53e1c436.chunk.js.map