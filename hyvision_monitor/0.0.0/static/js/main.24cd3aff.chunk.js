(this.webpackJsonpInspectionMonitor=this.webpackJsonpInspectionMonitor||[]).push([[0],{204:function(e,t,n){e.exports=n(464)},209:function(e,t,n){},210:function(e,t,n){e.exports=n.p+"static/media/logo.ee7cd8ed.svg"},211:function(e,t,n){},464:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),o=n(7),r=n.n(o),s=(n(209),n(39)),c=n(192),l=n(86),u=n(126),d=n(21),h=n(18),p=n(41),f=n(40),m=n(42),g=(n(210),n(211),n(27));function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-1,a=e,i=n+1;if(void 0!==e){for(var o=0;o<i;o++){var r=t[o];if(void 0===(a=a[r]))return}return a}}n(212);var y=n(8),b=n.n(y),S=n(66),E=n.n(S),O=n(193),k=(n(213),n(67)),R=n.n(k),D="http://hyv.decade.tw:8080/";var C,F=n(198),_=n.n(F),w=n(121),I=n.n(w),j=n(195),T=n.n(j),U=n(56),L=n.n(U),x=n(31),M=n.n(x),N=n(65),P=n.n(N),A=(n(218),new TextEncoder,{NA:-128,SUCCESS:0,FAILURE:-1}),H=n(119),G=n.n(H).a.CheckableTag,B=T.a.RangePicker,Q=M.a.Title;M.a.Paragraph,M.a.Text,O.getLogger("AnalysisUI");function $(e){function t(e){return e<10?"0"+e:e}var n=t(e.getMonth()+1),a=t(e.getDate()),i=t(e.getHours()),o=t(e.getMinutes()),r=t(e.getSeconds());return[e.getFullYear(),n,a].join("/")+" "+i+":"+o+":"+r}function Y(e,t){e.forEach((function(e){e.stat.forEach((function(e){var n=t.find((function(t){return t.id==e.id}));if(void 0!==n){var a=function(e,t,n,a,i){var o=(n-e)/(3*t),r=(e-a)/(3*t),s=Math.min(o,r),c=(e-i)/((n-a)/2);return{mean:e,sigma:t,CPU:o,CPL:r,CP:s,CA:c,CPK:s*(1-Math.abs(c))}}(e.mean,e.sigma,n.USL,n.LSL,n.value);Object.assign(e,a)}}))}))}function X(e,t,n){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12e4,n=e,a=[],i=void 0;function o(e){void 0!==e&&(i={group:[e],startTime:e.time_ms,endTime:e.time_ms},a.push(i))}o(n[0]);for(var r=1;r<n.length;r++)n[r].time_ms-i.endTime<t?(i.group.push(n[r]),i.endTime=n[r].time_ms):o(n[r]);return a.forEach((function(e){var t=e.group;if(0!=t.length){var n=t[0].judgeReports.map((function(e){return{id:e.id}}));n=n.map((function(e){var n=t.map((function(t){return t.judgeReports.find((function(t){return t.id==e.id}))})),a=n.filter((function(e){return e.status!==A.NA})),i=a.reduce((function(e,t){return e+t.value}),0)/a.length,o=n.reduce((function(e,t){return t.status===A.NA||((void 0===e.max||null===e.max||t.value>e.max)&&(e.max=t.value),(void 0===e.min||null===e.min||t.value<e.min)&&(e.min=t.value)),e}),{min:void 0,max:void 0}),r=Math.sqrt(a.reduce((function(e,t){return e+(i-+t.value)*(i-+t.value)}),0)/a.length);return{id:e.id,mean:i,sigma:r,min:o.min,max:o.max}})),e.stat=n}})),a}(e,t);return Y(a,n),a}P.a.pluginService.register({afterDraw:function(e){}});var q="NA",z="UOK",J="LOK",W="UCNG",V="LCNG",K="USNG",Z="LSNG";C={},Object(g.a)(C,q,{COLOR:"#aaa",TEXT:q}),Object(g.a)(C,z,{COLOR:"#87d068",TEXT:z}),Object(g.a)(C,J,{COLOR:"#87d068",TEXT:J}),Object(g.a)(C,W,{COLOR:"#d0d068",TEXT:W}),Object(g.a)(C,V,{COLOR:"#d0d068",TEXT:V}),Object(g.a)(C,K,{COLOR:"#f50",TEXT:K}),Object(g.a)(C,Z,{COLOR:"#f50",TEXT:Z});var ee=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(f.a)(t).call(this,e))).divID="ControlChart_ID_"+Math.round(1e4*Math.random()),n.charObj=void 0,n.state={chartOpt:{type:"line",data:{labels:[],datasets:[{borderColor:"rgba(100, 255, 100,0)",lineTension:0,data:[],pointBackgroundColor:[]},{type:"scatter",borderColor:"rgba(100, 255, 100)",lineTension:0,data:[],pointBackgroundColor:[]}]},bezierCurve:!1,options:{scales:{xAxes:[{display:!0,type:"time",distribution:"linear",ticks:{callback:function(e,t,n){return e.toString()},source:"labels",autoSkip:!0},time:{displayFormat:!0,displayFormats:{hour:"MMM D, h:mm:ss"},minUnit:"hour"}}],yAxes:[{display:!0,scaleLabel:{display:!0}}]},elements:{line:{fill:!1},point:{radius:6}},bezierCurve:!1,animation:{duration:0},maintainAspectRatio:!1,responsive:!0,title:{display:!0,text:""},annotation:{annotations:[]},legend:{display:!0},tooltips:{enabled:!0}}}},n.state.chartOpt.options.pan={enabled:!0,mode:"y"},n.state.chartOpt.options.zoom={enabled:!0,mode:"y"},n.default_annotationTargets=[{type:"USL",color:"rgba(200, 0, 0,0.2)"},{type:"LSL",color:"rgba(200, 0, 0,0.2)"},{type:"UCL",color:"rgba(100, 100, 0,0.2)"},{type:"LCL",color:"rgba(100, 100, 0,0.2)"},{type:"value",color:"rgba(0, 0, 0,0.2)"}],n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(e,t){}},{key:"componentWillUpdate",value:function(e,t){this.PropsUpdate(e)}},{key:"genSingleRepPoints",value:function(e,t,n,a){var i=t.value;return e.reduce((function(e,t){return e.concat(t.group)}),[]).reduce((function(e,o,r){if(void 0!==n&&(n[0]>o.time_ms||n[1]<o.time_ms))return e;var s=o.judgeReports.find((function(e){return e.id===t.id})),c=s.value,l=a;if(void 0===l)switch(s.status){case A.SUCCESS:l="rgba(0,255,200,0.2)";break;case A.FAILURE:l="rgba(255,0,200,0.2)";break;case A.NA:l="#000000",c=i}else s.status===A.NA&&(l="#000000",c=i);var u={x:new Date(o.time_ms).toString(),y:c};return e.pointBackgroundColor.push(l),e.data.push(u),e}),{borderColor:"rgba(100, 255, 100,0)",lineTension:0,data:[],pointBackgroundColor:[]})}},{key:"dataPointNormalizer",value:function(e,t,n,a){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return t==a||i&&(n<=a?a=n-(t-n):n>=t&&(t=n+(n-a)),t<=n||a>=n)?1/0:e>n?(e-n)/(t-n):(e-n)/(n-a)}},{key:"genGroupRepPoints",value:function(e,t,n,a){return e.reduce((function(e,i){var o=i.stat.find((function(e){return e.id===t.id})),r=o.mean,s=i.group.reduce((function(e,t){return e+t.time_ms}),0)/i.group.length;if(void 0!==n&&(n[0]>s||n[1]<s))return e;var c=void 0===a?"rgba(0,255,0,1)":a,l={x:new Date(s).toString(),y:r,data:i,stat:o};return e.pointBackgroundColor.push(c),e.data.push(l),e}),{type:"scatter",borderColor:"rgba(100, 255, 100,1)",lineTension:0,data:[],pointBackgroundColor:[]})}},{key:"colorPalette",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"100%",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"50%",r=360*e/t+a;return"hsla("+r+", "+i+", "+o+","+n+")"}},{key:"PropsUpdate",value:function(e){console.log(">>>>");var t=1!=e.targetMeasure.length;this.doChartDataUpdate(e,t);var n=-100,a=100,i=0;if(t)n=-100,a=100,i=0;else{var o=e.targetMeasure[0];n=o.LSL,a=o.USL,i=o.value}0==n&&0==a&&0==i||(this.state.chartOpt.options.scales.yAxes[0].ticks={min:1.2*(n-i)+i,max:1.2*(a-i)+i}),this.charObj.update()}},{key:"doChartDataUpdate",value:function(e,t){var n=this;if(this.state.chartOpt.data.labels=[],this.state.chartOpt.data.datasets.forEach((function(e){e.data=[],e.pointBackgroundColor=[]})),0!==e.inspectionRecGroup.length){var a=e.inspectionRecGroup,i=e.xAxisRange,o=-100,r=100,s=0;if(this.state.chartOpt.data.datasets=[],t)o=-100,r=100,s=0;else{var c=e.targetMeasure[0];o=c.LSL,r=c.USL,s=c.value}e.targetMeasure.forEach((function(e,o,s){var c=s.length>1?n.colorPalette(o,s.length,.4,100):void 0,l=n.genSingleRepPoints(a,e,i,c),u=n.colorPalette(o,s.length,1,100),d=n.genGroupRepPoints(a,e,i,u);if(t){var h=e.LSL,p=e.USL,f=e.value;l.data.forEach((function(e){e.original_y=e.y,e.y=r*n.dataPointNormalizer(e.y,p,f,h)})),d.data.forEach((function(e){e.original_y=e.y,e.y=r*n.dataPointNormalizer(e.y,p,f,h)}))}else l.data.forEach((function(e){e.original_y=e.y})),d.data.forEach((function(e){e.original_y=e.y}));var m=n.state.chartOpt.data.datasets;m.push(l),m.push(d),m[m.length-2].label="",m[m.length-1].label=e.name,m[m.length-2].backgroundColor=c,m[m.length-1].borderColor=u,m[m.length-1].backgroundColor=u})),this.state.chartOpt.data.labels=a.map((function(e){return $(new Date((e.startTime+e.endTime)/2))}));var l=this.props.anotationTargets;void 0===l&&(l=this.default_annotationTargets);var u={USL:r,LSL:o,value:s};this.state.chartOpt.options.annotation.annotations=l.map((function(e){return{type:"line",mode:"horizontal",scaleID:"y-axis-0",value:u[e.type],borderColor:e.color,borderWidth:4,borderDash:[12,12],label:{position:"right",enabled:!0,content:""},onMouseover:function(e){document.getElementById("info").innerHTML="whatever"}}})),this.state.chartOpt.options.tooltips={callbacks:{title:function(e,t){return""},label:function(e,t){var n=e.datasetIndex;if(void 0===n)return"";var a=e.index;return t.datasets[n].data[a].original_y},afterLabel:function(e,t){var n=e.datasetIndex,a=e.index,i=t.datasets[n].data[a],o=i.stat;if(void 0==o)return i.x;var r=i.data.group.length;if(0==r)return i.x;var s=[b()(i.data.group[0].time_ms).format("YYYY/MM/DD , h:mm:ss a"),b()(i.data.group[r-1].time_ms).format("YYYY/MM/DD , h:mm:ss a")],c=Object.keys(o).map((function(e){return e+":"+(null!=o[e]?o[e].toFixed(4):"NULL")}));return s=s.concat(c),void 0!==i.data.group&&s.push("count:"+i.data.group.length),s}},backgroundColor:"#FFF",titleFontSize:16,titleFontColor:"#0066ff",bodyFontColor:"#000",bodyFontSize:14,displayColors:!0}}}},{key:"componentDidMount",value:function(){var e=document.getElementById(this.divID).getContext("2d");this.charObj=new P.a(e,this.state.chartOpt),this.PropsUpdate(this.props)}},{key:"render",value:function(){return i.a.createElement("div",{className:this.props.className,style:this.props.style},i.a.createElement("canvas",{id:this.divID,style:{height:"100%"},className:this.props.className}))}}]),t}(i.a.Component);function te(e,t){return void 0===e&&(e=new Date),e.setDate(e.getDate()+t)}var ne=function(){function e(){Object(d.a)(this,e),this.reset(),this.newFeedCallBack=function(e,t){return console.log("newFeedCallBack=>",e,t)},this.liveFeedMode=!1}return Object(h.a)(e,[{key:"resetStreamInfo",value:function(){this.rec=[],this.liveFeedInterval=1e4,this.passiveQueryRange=[],this.liveQueryRange=[],void 0!==this.timeoutHDL&&clearTimeout(this.timeoutHDL),this.timeoutHDL=void 0}},{key:"reset",value:function(){this.defFile=void 0,this.resetStreamInfo()}},{key:"setDefFile",value:function(e){this.resetStreamInfo(),this.defFile=JSON.parse(JSON.stringify(e)),console.log("setDefFile=",e)}},{key:"newStreamFeed",value:function(e){if(e.sort((function(e,t){return e.time_ms-t.time_ms})),this.rec.length>0){var t=this.rec[this.rec.length-1].time_ms,n=e.filter((function(e){return e.time_ms>t})),a=this.rec.concat(n);console.log(this.rec.length,e.length,a.length),this.rec=a}else this.rec=e;this.newFeedCallBack(e,this.rec)}},{key:"setLiveFeedMode",value:function(e){return console.log(e),this.rec.length<0&&(e=!1),console.log(this.rec),e?void 0==this.timeoutHDL&&this.liveQueryInspRec():void 0!==this.timeoutHDL&&(clearTimeout(this.timeoutHDL),this.timeoutHDL=void 0),this.liveFeedMode=e}},{key:"liveQueryInspRec",value:function(e,t){var n=this;if(void 0==e){if(!(this.rec.length>0))return console.log("No existed rec to do live query"),void(this.timeoutHDL=void 0);var a=this.rec[this.rec.length-1].time_ms;e=[b()(a)._d.getTime(),b()(te(new Date,1))._d.getTime()],console.log(b()(a))}return void 0==t&&(t=10),console.log("timeRange="+e),function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i="query/inspection",o=D+i+"?";return o+="tStart="+t.toString()+"&tEnd="+n.toString()+"&",o+="limit="+a+"&page=1&",o+="subFeatureDefSha1="+e+"&",o+="projection="+JSON.stringify({_id:0,"InspectionData.time_ms":1,"InspectionData.judgeReports.id":1,"InspectionData.judgeReports.value":1,"InspectionData.judgeReports.status":1,createdAt:1,updatedAt:1,"InspectionData.tag":1}),o+="",new Promise((function(e,t){R()(o,(function(n,a){null===n?e(a):t(n),console.log(n,a)}))}))}(this.defFile.featureSet_sha1,e[0],e[1],t).then((function(e){var t=e.map((function(e){return e.InspectionData[0]}));return n.newStreamFeed(t),n.liveFeedMode?n.timeoutHDL=setTimeout((function(){return n.liveQueryInspRec()}),n.liveFeedInterval):n.timeoutHDL=void 0,t}))}},{key:"queryInspRec",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[b()(te(new Date,-7)),b()(te(new Date,1))];return void 0!==this.defFile&&(this.passiveQueryRange=e,this.liveFeedMode||this.resetStreamInfo(),this.liveQueryInspRec(e,1e7))}}]),e}(),ae=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(f.a)(t).call(this,e))).ec_canvas=null,n.state={defFileSearchName:"",dateRange:[b()(te(new Date,-1)),b()(te(new Date,1))],displayRange:[b()(0),b()(te(new Date,1))],inspectionRec:[],inspectionRec_TagFiltered:[],inspectionRecGroup:[],groupInterval:12e4,liveFeedMode:!1,dataInSync:!1,controlChartOverlap:!1},n.recStream=new ne,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){}}]),Object(h.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.defFile!==this.props.defFile&&this.recStream.setDefFile(e.defFile),!0}},{key:"stateUpdate",value:function(e){return this.setState(Object(s.a)({},this.state,{},e))}},{key:"liveFeedMode_ctrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.state.liveFeedMode;return e=this.recStream.setLiveFeedMode(e),this.stateUpdate({liveFeedMode:e})}},{key:"render",value:function(){var e=this;if(void 0===this.props.defFile)return null;var t,n=2===this.state.dateRange.length&&this.state.dateRange.reduce((function(e,t){return e&&void 0!==t._d&&void 0!==t._d.getTime}),!0),a=this.state.dateRange.map((function(e){return e._d})),o=(this.props.DefFileHash,this.props.DefFileName,("string"===typeof(t=this.props.DefFileHash)||t instanceof String)&&this.props.DefFileHash.length>5);console.log(this.props.defFile);var r=this.props.defFile.featureSet[0].features.filter((function(e){return"measure"===e.type}));console.log(this.props.defFile),document.title=this.props.defFile.name;var s=i.a.createElement(M.a,null,i.a.createElement(Q,null,this.props.defFile.name)),c=null;this.state.inspectionRec.length>0&&(c=[i.a.createElement(_.a,{range:!0,min:this.state.inspectionRec[0].time_ms-1e3,max:this.state.inspectionRec[this.state.inspectionRec.length-1].time_ms+1e3,defaultValue:[this.state.inspectionRec[0].time_ms-1e3,this.state.inspectionRec[this.state.inspectionRec.length-1].time_ms+1e3],step:3e5,tipFormatter:function(e){return new Date(e).toString()},onChange:function(t){return e.stateUpdate({displayRange:t})}}),i.a.createElement(L.a,{checked:this.state.liveFeedMode,onChange:function(t){return e.liveFeedMode_ctrl(t.target.checked)}},"LIVE"),"  \u62bd\u6aa2\u9593\u9694",i.a.createElement(I.a,{defaultValue:b()("0:"+this.state.groupInterval/6e4,"HH:mm"),format:"HH:mm",hourStep:3,minuteStep:1,allowClear:!1,onChange:function(t){if(null!==t){console.log(t);var n=t._d.getTime(),a=b()(t._d).startOf("date")._d.getTime();console.log(n-a);var i=n-a;console.log("TimePicker",e.state.inspectionRec_TagFiltered);var o=X(e.state.inspectionRec_TagFiltered,i,r);e.stateUpdate({inspectionRecGroup:o,groupInterval:i})}}}),i.a.createElement(L.a,{checked:this.state.controlChartOverlap,onChange:function(t){return e.setState({controlChartOverlap:t.target.checked})}},"\u91cd\u758a\u986f\u793a")]);var l=null;return l=this.state.controlChartOverlap?i.a.createElement("div",{style:{width:"95%",height:"100%"}},i.a.createElement(ee,{inspectionRecGroup:this.state.inspectionRecGroup,style:{height:"100%"},key:"_",targetMeasure:r,xAxisRange:this.state.displayRange})):i.a.createElement("div",{style:{width:"95%"}},r.map((function(t){return i.a.createElement(ee,{inspectionRecGroup:e.state.inspectionRecGroup,style:{height:"400px"},key:t.name+"_",targetMeasure:[t],xAxisRange:e.state.displayRange})}))),i.a.createElement("div",{className:"HXF"},i.a.createElement("div",{className:"overlayCon s overlayCon width12 HXF"},s,i.a.createElement("div",{className:"s height12"},i.a.createElement(B,{key:"RP",defaultValue:this.state.dateRange,onChange:function(t){return e.stateUpdate({dateRange:t})}}),i.a.createElement(E.a,{type:"primary",icon:"search",disabled:!n||!o||this.state.dataInSync,onClick:function(){e.recStream.newFeedCallBack=function(t,n){if(t.length>0){var a=t[t.length-1].time_ms,i=X(n,e.state.groupInterval,r);e.stateUpdate({inspectionRec:n,inspectionRecGroup:i,inspectionRec_TagFiltered:n,displayRange:[e.state.displayRange[0],b()(a+1e3)]})}},e.stateUpdate({dataInSync:!0}),e.recStream.queryInspRec(a).then((function(t){e.stateUpdate({dataInSync:!1})})).catch((function(t){e.stateUpdate({dataInSync:!1})}))}}),i.a.createElement(E.a,{type:"primary",icon:"download",disabled:!n||!o||0===this.state.inspectionRec.length,onClick:function(){var t=e.props.defFile.name+"_"+function(e){var t=e.getMonth()+1,n=e.getDate();return[e.getFullYear(),(t>9?"":"0")+t,(n>9?"":"0")+n].join("")}(new Date),n=function(e,t,n){var a=[];function i(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n[n.length-1];e.push('"'+a+'"'),t.forEach((function(t){var a=v(t,n);void 0===a&&(a=""),e.push(',"'+a+'"')})),e.push("\n")}a.push('"'+e+'"'),a.push(',"0.0.1 Alpha"'),a.push(",\n"),console.log(t,n),["name","subtype"].forEach((function(e){return i(a,t,[e])})),["USL","LSL","value","UCL","LCL"].forEach((function(e){return i(a,t,[e])})),a.push(",\n");var o=["tag"];return n.forEach((function(e){e.group.forEach((function(e){var n=e.judgeReports;a.push($(new Date(e.time_ms))),t.forEach((function(e){var t=n.find((function(t){return t.id==e.id}));t.status!==A.NA?a.push(","+t.value):a.push(",")})),o.forEach((function(t){switch(a.push(","),t){case"tag":var n=e.tag;(void 0===n||","==n)&&(n=""),a.push('"'+n+'"')}})),a.push("\n")}))})),a}(t,r,e.state.inspectionRecGroup);n.join("");!function(e,t,n){var a=new Blob([new Uint8Array([239,187,191]),e],{type:t}),i=document.createElement("a");i.download=n,i.href=URL.createObjectURL(a),i.dataset.downloadurl=[t,i.download,i.href].join(":"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout((function(){URL.revokeObjectURL(i.href)}),1500)}(n.join(""),"text/csv",t+".csv")}}),i.a.createElement("hr",{style:{width:"80%"}}),i.a.createElement(oe,{fullStream2Tag:this.state.inspectionRec,onTagStateChange:function(t){var n=Object.keys(t).filter((function(e){return t[e]})),a=e.state.inspectionRec.filter((function(e,t,a){var i=e.tag.split(",");return n.every((function(e){return i.includes(e)}))})),i=X(a,e.state.groupInterval,r);e.stateUpdate({inspectionRecGroup:i,inspectionRec_TagFiltered:a})}}),i.a.createElement("hr",{style:{width:"80%"}})),c,l,i.a.createElement("div",{key:"k1",className:"s overlay scroll MenuAnim HXA",style:{top:"0px",width:"100px"}},[])))}}]),t}(i.a.Component);var ie=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(f.a)(t).call(this,e))).handleChange2=function(e){n.setState({checked:e}),console.log("handleChange=",n.props.tagName,e),n.props.handleChange(e)},n.state={checked:!0},console.log("New"),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n,a;return console.log("shouldComponentUpdate",e,t),e.tagName===this.props.tagName&&(e.fullStream2Tag,n=e.tagName,a=t.checked,console.log("updateChart=",n,a)),!0}},{key:"componentWillReceiveProps",value:function(e){}},{key:"appendTagtitle",value:function(e){return i.a.createElement("h1",null,e.name)}},{key:"render",value:function(){return console.log("handleChange=",this.props.tagName,this.state.checked),i.a.createElement(G,Object.assign({},this.props,{checked:this.state.checked,onChange:this.handleChange2}))}}]),t}(i.a.Component),oe=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(f.a)(t).call(this,e))).handleTagChange=function(e,t){var a=Object(s.a)({},n.state.tags);a[e]=t,n.props.onTagStateChange(a),n.setState({tags:a})},n.state={tags:{}},n.checkInspectionRec=void 0,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillReceiveProps",value:function(e){if(this.checkInspectionRec!==e.fullStream2Tag){this.checkInspectionRec=e.fullStream2Tag,console.log("props.fullStream2Tag",e.fullStream2Tag);var t=new Set;if(e.fullStream2Tag.length>0){e.fullStream2Tag.forEach((function(e,n,a){e.tag.split(",").forEach((function(e,n,a){0!=e.length&&t.add(e)}))}));var n={};Array.from(t).forEach((function(e){n[e]=!0})),this.setState({tags:n}),this.props.onTagStateChange(n)}}}},{key:"handleTagChange",value:function(){console.log("handleTagChange")}},{key:"render",value:function(){var e=this;return console.log("this.state.tags",this.state.tags),i.a.createElement("div",null,i.a.createElement("h6",{style:{marginRight:8,display:"inline"}},"Uni Categories:"),Object.keys(this.state.tags).map((function(t,n,a){return console.log("Array.from(uniSet2).map=",n+"="+t),i.a.createElement(ie,{tagIndex:n,tagName:t,key:t,handleChange:function(n){return e.handleTagChange(t,n)}},t)})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){console.log("props.fullStream2Tag",e.fullStream2Tag);var n=new Set;if(e.fullStream2Tag.length>0){e.fullStream2Tag.forEach((function(e,t,a){e.tag.split(",").forEach((function(e,t,a){0!=e.length&&n.add(e)}))}));var a=Object(s.a)({},t.tags);return Array.from(n).forEach((function(e){void 0===a[e]&&(a[e]=!0)})),{tags:a}}return null}}]),t}(i.a.Component),re=ae,se=n(85),ce=n(123),le=n.n(ce),ue=n(124),de=n.n(ue),he=n(203),pe=n.n(he),fe=n(202),me=n.n(fe),ge=n(44),ve=n.n(ge);se.a.WORKER_PATH="./qr-scanner-worker.min.js";var ye=M.a.Title;M.a.Paragraph,M.a.Text,i.a.Component;function be(e){var t=e?e.split("?")[1]:window.location.search.slice(1),n={};if(t=decodeURI(t))for(var a=(t=t.split("#")[0]).split("&"),i=0;i<a.length;i++){var o=a[i].split("="),r=o[0],s="undefined"===typeof o[1]||o[1];if(r.match(/\[(\d+)?\]$/)){var c=r.replace(/\[(\d+)?\]/,"");if(n[c]||(n[c]=[]),r.match(/\[\d+\]$/)){var l=/\[(\d+)\]/.exec(r)[1];n[c][l]=s}else n[c].push(s)}else n[r]?n[r]&&"string"===typeof n[r]?(n[r]=[n[r]],n[r].push(s)):n[r].push(s):n[r]=s}return n}function Se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TIMEOUT";return new Promise((function(a,i){var o=void 0;t>0&&(o=setTimeout((function(){o=void 0,i(n)}),t)),R()(e,(function(e,t){clearTimeout(o),null===e?a(t):i(e)}))}))}function Ee(e){var t=e.onQueryRes,n=e.onQueryRej,o=e.placeholder,r=e.defaultValue,s=Object(a.useState)([]),c=Object(l.a)(s,2),d=c[0],h=c[1],p=i.a.createElement(le.a,{placeholder:o,defaultValue:r,onPressEnter:function(e){console.log(e.target.value),h(),function(e){var t=void 0;return new Promise((function(n,a){Se("http://hyv.decade.tw:8080/query/deffile?name="+e+"&limit=1000",null).then((function(e){var n="http://hyv.decade.tw:8080/query/inspection?",a=e.map((function(e){return e.DefineFile.featureSet_sha1}));return a=Object(u.a)(new Set(a)),t=a.map((function(t){var n=e.filter((function(e){return e.DefineFile.featureSet_sha1==t})).map((function(e){return e.DefineFile.name}));return{hash:t,name:n}})).map((function(e){return e.name=Object(u.a)(new Set(e.name)),e})),n+="tStart=0&tEnd=2581663256894&limit=999999999&",n+="subFeatureDefSha1="+a.reduce((function(e,t){return void 0===e?t:e+"|"+t}),void 0)+"&",n+='projection={"_id":0,"InspectionData.subFeatureDefSha1":1,"InspectionData.time_ms":1,"InspectionData.tag":1}&',Se(n+='agg=[{"$group":{"_id":"$InspectionData.subFeatureDefSha1","count": {"$sum":1},"time_start": {"$min":"$InspectionData.time_ms"},"time_end": {"$max":"$InspectionData.time_ms"},"tags": {"$addToSet":"$InspectionData.tag"}}}]',null)})).then((function(e){var a=e.map((function(e){return e._id=e._id[0],e})).reduce((function(e,t){var n=t._id;return void 0===e[n]?(e[n]=t,delete e[n]._id):(e[n].count+=t.count,e[n].time_start=[Math.min(e[n].time_start[0],t.time_start[0])],e[n].time_end=[Math.max(e[n].time_end[0],t.time_end[0])]),e}),{});t.forEach((function(e){var t=a[e.hash];void 0!==t&&Object.assign(e,t)})),n(t)})).catch((function(e){a(e)}))}))}(e.target.value).then((function(e){h(e),t(e)})).catch((function(e){h([]),void 0!==n&&n(e)}))}}),f=(void 0===d||i.a.createElement("div",null),null);if(void 0!==d){var m=[{title:"Name",dataIndex:"name",key:"name",render:function(e){return i.a.createElement("a",{href:window.location.href.substring(window.location.protocol.length).split("?")[0]+"?v=0&hash="+e.hash},e.name)}},{title:"count",dataIndex:"count",key:"count",sorter:function(e,t){return e.count-t.count}},{title:"Date_Start",dataIndex:"Date_Start",key:"Date_Start",render:function(e){return i.a.createElement("div",null,new Date(e)+"")},sorter:function(e,t){return e.Date_Start-t.Date_Start}},{title:"Date_End",dataIndex:"Date_End",key:"Date_End",render:function(e){return i.a.createElement("div",null,new Date(e)+"")},sorter:function(e,t){return e.Date_End-t.Date_End}},{title:"Tags",dataIndex:"Tags",key:"Tags"}],g=d.filter((function(e){return void 0!==e.count})).map((function(e){var t={name:e};return void 0!==e.count&&(t.count=e.count,t.Date_Start=e.time_start[0],t.Date_End=e.time_end[0],t.Tags=e.tags),t}));console.log(g),f=i.a.createElement(de.a,{columns:m,dataSource:g,pagination:!1})}return i.a.createElement("div",null,p,f)}function Oe(e){var t=e.displayInfo,n=i.a.useRef(null);return i.a.createElement("div",null,i.a.createElement(ye,{level:2},t.name),JSON.stringify(t),i.a.createElement("canvas",{key:"canv",ref:n,onClick:function(e){n.current.getContext("2d")}}))}function ke(e){Object(c.a)(e);var t=Object(a.useState)(void 0),n=Object(l.a)(t,2),o=n[0],r=n[1],s=Object(a.useState)(!0),u=Object(l.a)(s,2),d=u[0],h=u[1];Object(a.useEffect)((function(){var e;return r(void 0),(e="Machine",new Promise((function(t,n){Se("http://hyv.decade.tw:8080/QUERY/customDisplay?name="+e,null).then((function(e){t(e)})).catch((function(e){n(e)}))}))).then((function(e){console.log(o),r(e.prod)})).catch((function(e){console.log(e)})),function(){console.log("1,didUpdate ret::")}}),[]),Object(a.useEffect)((function(){console.log("2,count->useEffect>>")}),[o]);var p=null;return void 0!==o&&(console.log(o),(p=[]).push(i.a.createElement("div",{key:"Reset",onClick:function(){return r(void 0)}},"RESET....")),p.push(i.a.createElement(me.a,{key:"table",style:{height:"50%"}},o.map((function(e){return i.a.createElement(pe.a,{key:e.name,span:12,style:{height:"100%"}},i.a.createElement(Oe,{displayInfo:e}))}))))),i.a.createElement(ve.a,{style:{height:"100%"}},i.a.createElement(ve.a.Header,{style:{color:"#FFFFFF"}},"Header"),i.a.createElement(ve.a,null,i.a.createElement(ve.a.Sider,{style:{color:"#FFFFFF"},collapsible:!0,collapsed:d,onCollapse:function(){return h(!d)},onMouseOut:function(){return d?null:h(!0)},onMouseOver:function(){return d?h(!1):null}},"Sider"),i.a.createElement(ve.a,null,i.a.createElement(ve.a.Content,{style:{padding:"50px 50px"}},p),i.a.createElement(ve.a.Footer,null,"Costom UI v0.0.0"))))}var Re=function(e){function t(e){var n;return Object(d.a)(this,t),n=Object(p.a)(this,Object(f.a)(t).call(this,e)),console.log(be()),n.state={DefFileInfo:void 0,allowQRScan:!1,UI:void 0},n.UI_type={customDisplay:"customDisplay",analysis:"analysis",search:"search"},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=be();console.log(e),"customDisplay"===e.UI?this.setState({UI:this.UI_type.customDisplay}):void 0!==e.v&&void 0!==e.hash?(this.onQRScanResult(JSON.stringify(e)),this.setState({UI:this.UI_type.analysis})):this.setState({allowQRScan:!0,UI:this.UI_type.search})}},{key:"onDefFileInfoUpdate",value:function(e){var t=this;this.setState(Object(s.a)({},this.state,{DefFileInfo:e})),console.log(e),function(e,t,n){var a=D+"query/deffile?";return a+="limit=1000",void 0!==e&&(a+="&name="+e),void 0!==t&&(a+="&featureSet_sha1="+t),a+=void 0!==n?"&projection="+JSON.stringify(n):"&projection={}",new Promise((function(e,t){R()(a,(function(n,a){null===n?e(a):t(n),console.log(n,a)}))}))}(e.name,e.hash).then((function(e){e.length>0&&t.setState(Object(s.a)({},t.state,{defFile:e[0].DefineFile})),console.log(e)}))}},{key:"onQRScanResult",value:function(e){try{var t=JSON.parse(e);("string"===typeof(n=t.v)||n instanceof String)&&(t.v=Number(t.v)),0===t.v&&void 0!==t.hash&&t.hash.length>5&&(console.log(window.location.protocol),"https:"===window.location.protocol?(window.location.href="http:"+window.location.href.substring(window.location.protocol.length).split("?")[0]+"?v="+t.v+"&hash="+t.hash,console.log(window.location.href),this.setState(Object(s.a)({},this.state,{allowQRScan:!1}))):this.onDefFileInfoUpdate(t))}catch(a){alert(a)}var n}},{key:"render",value:function(){var e;switch(this.state.UI){case this.UI_type.customDisplay:e=i.a.createElement(ke,null);break;case this.UI_type.analysis:e=i.a.createElement(re,{DefFileHash:this.state.DefFileInfo.hash,DefFileName:this.state.DefFileInfo.name,defFile:this.state.defFile});break;case this.UI_type.search:e=i.a.createElement(Ee,{onQueryRes:function(e){console.log(e)},defaultValue:"3421",placeholder:"\u8f38\u5165\u540d\u7a31"})}return i.a.createElement("div",{className:"App",style:{height:"100%"}},e)}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(Re,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[204,1,2]]]);
//# sourceMappingURL=main.24cd3aff.chunk.js.map